define(["jquery","mcs","mcs_config"],function(e){function o(){function o(){n(),t.mobileBackend=mcs.MobileBackendManager.returnMobileBackend(t.MBE_NAME,mcs_config),t.mobileBackend.setAuthenticationType(t.MBE_AUTH_TYPE)}var t=this;t.mobileBackend,t.MBE_AUTH_TYPE,t.MBE_NAME,t.MBE_BaseURL,t.MBE_ID,t.MBE_AnonymousToken,t.MBE_ApplicationKey,t.MBE_OAuthClientId,t.MBE_OAuthClientSecret,t.MBE_OAuthTokenEndpoint,t.appId="com.oraclecorp.internal.ent3.chinamcsdemopush",t.appVersion="1.0.0";var n=function(){mcs_config.logLevel=mcs.logLevelInfo;var e=new Array(mcs_config.mobileBackends);if(e.length>0){t.MBE_NAME=Object.keys(e[0])[0];var o=window.localStorage,n=o.getItem("mbe_baseUrl");null!=n&&n.length>0&&(e[0][t.MBE_NAME].baseUrl=n),n=o.getItem("mbe_basicAuth_backendId"),null!=n&&n.length>0&&(e[0][t.MBE_NAME].authorization.basicAuth.backendId=n),n=o.getItem("mbe_basicAuth_anonymousToken"),null!=n&&n.length>0&&(e[0][t.MBE_NAME].authorization.basicAuth.anonymousToken=n),n=o.getItem("applicationKey"),null!=n&&n.length>0&&(e[0][t.MBE_NAME].applicationKey=n),n=o.getItem("clientId"),null!=n&&n.length>0&&(e[0][t.MBE_NAME].authorization.oAuth.clientId=n),n=o.getItem("clientSecret"),null!=n&&n.length>0&&(e[0][t.MBE_NAME].authorization.oAuth.clientSecret=n),n=o.getItem("tokenEndpoint"),null!=n&&n.length>0&&(e[0][t.MBE_NAME].authorization.oAuth.tokenEndpoint=n),n=o.getItem("authType"),null!=n&&n.length>0&&(e[0][t.MBE_NAME].authType=n),t.MBE_BaseURL=e[0][t.MBE_NAME].baseUrl,t.MBE_ID=e[0][t.MBE_NAME].authorization.basicAuth.backendId,t.MBE_AnonymousToken=e[0][t.MBE_NAME].authorization.basicAuth.anonymousToken,t.MBE_ApplicationKey=e[0][t.MBE_NAME].applicationKey,t.MBE_OAuthClientId=e[0][t.MBE_NAME].authorization.oAuth.clientId,t.MBE_OAuthClientSecret=e[0][t.MBE_NAME].authorization.oAuth.clientSecret,t.MBE_OAuthTokenEndpoint=e[0][t.MBE_NAME].authorization.oAuth.tokenEndpoint,t.MBE_AUTH_TYPE=e[0][t.MBE_NAME].authType,console.log("[MBE]: Done init mcs_config!")}};t.authAnonymous=function(){console.log("Authenticating anonymously"),t.mobileBackend.Authorization.authenticateAnonymous(function(e,o){console.log("Success authenticating against mobile backend")},function(e,o){console.log("Failure authenticating against mobile backend")})},t.authenticate=function(o,n){function i(e,o){c.resolve(e,o)}function a(e,o){c.reject(e,o)}var c=e.Deferred();return t.mobileBackend.Authorization.authenticate(o,n,i,a),c.promise()},t.logout=function(e,o){t.mobileBackend.Authorization.logout()},t.isAuthorized=function(){return!!t.getAuthorizedUserName()},t.getAuthorizedUserName=function(){return console.log("MBE Authorization authorizedUserName: "+t.mobileBackend.Authorization.authorizedUserName),t.mobileBackend.Authorization.authorizedUserName},t.getAccessToken=function(){return console.log("MBE Authorization authorizedUserName: "+t.mobileBackend.Authorization.authorizedUserName),console.log("MBE Authorization AuthenticationType: "+t.mobileBackend.Authorization.AuthenticationType),console.log("MBE Authorization isAuthorized: "+t.mobileBackend.Authorization.isAuthorized()),console.log("MBE Authorization isTokenValid: "+t.mobileBackend.Authorization.isTokenValid()),console.log("MBE Authorization Token: "+t.mobileBackend.Authorization.getAccessToken()),t.mobileBackend.Authorization.getAccessToken()},t.invokePlatformRequest=function(e,o,n,i,a){var c=t.mobileBackend,l=c.getHttpHeaders();l["Content-Type"]="application/json";var u=JSON.stringify(n);mcs.MobileBackendManager.platform.invokeService({method:o,url:c.getPlatformUrl(e),headers:l,body:u,success:function(e,o){null!=i&&i(e.status,o)},error:function(e,o){null!=a&&a(e,o)}})},t.getAllCollections=function(e,o){t.invokePlatformRequest("storage/collections","GET",null,e,o)},t.getObjects=function(e,o,n){t.invokePlatformRequest("storage/collections/"+e+"/objects?orderBy=modifiedOn:desc","GET",null,o,n)},t.getObjectById=function(e,o,n,i){t.mobileBackend.Storage.getCollection(e,t.mobileBackend.Authorization.authorizedUserName,function(e){e.getObject(o,function(e){n(e.getPayload())},i,"blob")},i)},t.uploadFile=function(e,o,n,i,a,c){function l(e){var l=new mcs.StorageObject(e);return l.setDisplayName(o),l.loadPayload(n,i),t.postObject(e,l).then(a,c)}function u(o,t){var n="Failed to post storage object to "+e+" collection: "+o+" "+t;c(o,n)}t.getCollection(e).then(l,u)},t.getCollection=function(o){function n(e){console.log("Collection id: "+e.id+", description: "+e.description),a.resolve(e)}function i(e,o){console.log(mcs.logLevelInfo,"Failed to download storage collection:"+e),a.reject(e,o)}var a=e.Deferred();return t.mobileBackend.Storage.getCollection(o,t.mobileBackend.Authorization.authorizedUserName,n,i),a.promise()},t.postObject=function(o,t){function n(e,o){console.log("Posted storage object, id: "+o.id),a.resolve(o.id)}function i(e,o){console.log("Failed to post storage object: "+e),a.reject(e,o)}var a=e.Deferred();return o.postObject(t,n,i),a.promise()},t.invokeCustomAPI=function(e,o,n,i,a){var c=[{}];null!=n&&n.length>0&&(c=JSON.parse(n)),t.mobileBackend.CustomCode.invokeCustomCodeJSONRequest(e,o,c,i,a)},t.registerForNotifications=function(e,o,n){t.mobileBackend.Notifications.registerForNotifications(e,t.appId,t.appVersion,o,n)},o()}return new o});