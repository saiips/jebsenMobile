"use strict";requirejs.config({baseUrl:"js",paths:{knockout:"libs/knockout/knockout-3.4.0",mapping:"libs/knockout/knockout.mapping-latest",jquery:"libs/jquery/jquery-3.1.0.min","jqueryui-amd":"libs/jquery/jqueryui-amd-1.12.0.min",promise:"libs/es6-promise/es6-promise.min",hammerjs:"libs/hammer/hammer-2.0.8.min",ojdnd:"libs/dnd-polyfill/dnd-polyfill-1.0.0.min",ojs:"libs/oj/v2.2.0/min",ojL10n:"libs/oj/v2.2.0/ojL10n",ojtranslations:"libs/oj/v2.2.0/resources",text:"libs/require/text",signals:"libs/js-signals/signals.min",moment:"libs/moment/moment.min",mcs:"mcs/mcs",mcs_config:"mcs/oracle_mobile_cloud_config",mbe:"mbe/mbe",json:"libs/require/json",amplify:"libs/amplify/amplify.min",config:"app/config",pages:"app/pages",util:"app/util",lzstring:"libs/lz-string/lz-string.min",components:"app/components"},shim:{jquery:{exports:["jQuery","$"]},amplify:{deps:["jquery"],exports:"amplify"},maps:{deps:["jquery","i18n"],exports:["MVMapView"]}},config:{ojL10n:{merge:{"ojtranslations/nls/ojtranslations":"app/resources/nls/translations"}}}}),require(["ojs/ojcore","knockout","jquery","config/appconfig","appController","mbe","util/deviceready","util/devmode","util/errorhandler","util/appui","pages/common/constant","pages/common/maintenance","mcs_config","ojs/ojknockout","ojs/ojmodule","ojs/ojrouter","ojs/ojnavigationlist","ojs/ojbutton","ojs/ojdialog","ojs/ojtable","ojs/ojarraytabledatasource","promise","ojs/ojinputtext","ojs/ojselectcombobox","ojs/ojcollapsible"],function(o,e,n,t,a,s,i,r,l,c,u,m){function g(){var l=this;l.router=a.router,l.navDataSource=a.navDataSource,l.navChangeHandler=a.navChangeHandler,p=n.extend(!0,{},l.router.moduleConfig,{params:{rootContext:{}}}),l.moduleConfig=p,a.moduleConfig.params.rootContext.isOnline=i.isOnline(),a.moduleConfig.params.rootContext.isCordova=i.isCordova(),console.log("Mobile app runs on Cordova is "+a.moduleConfig.params.rootContext.isCordova);var E=t.get("devMode");console.log("devBuild="+E+"; isEnabled="+r.isEnabled()),E&&!r.isEnabled()?r.setDevOpts({useMCSMock:!1,isOffline:!1}):E&&r.isEnabled()?r.setDevOpts({useMCSMock:!0,isOffline:!0}):E||r.clear();var L=t.get("buildVersion");a.moduleConfig.params.rootContext.buildVersion=L;var C=t.get("environment");a.moduleConfig.params.rootContext.environment=C;var b=t.get("translation");if(l.showTranslation=e.computed(function(){return b}),b){var j=d("root"),v=d("lang");if("loading"==j)v?o.Config.setLocale(v):o.Config.setLocale(u.ZH_LOCALE);else{var y=c.getLocalStorage(u.LOCALE_KEY);console.log("stored locale = "+y),"undefined"!=typeof y&&y?o.Config.setLocale(y):o.Config.setLocale(u.DEFAULT_LOCALE)}}else o.Config.setLocale(u.DEFAULT_LOCALE);l.logout=function(){s.logout(),s.isLoggedIn=!1,o.Router.rootInstance.go("login")},l.clearStore=function(){console.log("clearStore");var e=a.moduleConfig.params.rootContext.isOnline,t=f("ssa.msg.error.ERROR_00005"),s=f("ssa.msg.info.maintenance");if(e){var i=m.isMaintenance();if(i)return void c.showMessageBox(s);confirm(f("ssa.msg.info.initialLoad"))&&(n.each(amplify.store(),function(o){o!=u.LOGIN_USER_KEY&&o!=u.LOGIN_REMEMBER_KEY&&o!=u.BASE64_LOGON_TOKEN&&o!=u.USER_PROFILE&&o!=u.CLIENT_FRONTEND_VERSION&&o!=u.CLIENT_BACKEND_VERSION&&o!=u.LOCALE_KEY&&o!=u.DEV_OPTS_KEY&&o!=u.DEV_AUTH_HEADERS_KEY&&o!=u.PRINTER_MAC_ADDRESS&&o!=u.PRINTER_SERIAL_NO&&amplify.store(o,null)}),c.setLocalStorage(u.REQUIRE_INIT_LOAD,"Y"),c.setLocalStorage(u.ORDER_DESK_VERSION,"Y"),o.Router.rootInstance.go("initLoad"))}else c.showMessageBox(t)},l.dataSync=function(){a.go("dataSync")},l.translate=function(){var t=c.getLocalStorage(u.LOCALE_KEY),a=f("ssa.locale");console.log("stored locale = "+t),console.log("current locale ="+a),"undefined"!=typeof t&&t?o.Config.setLocale(t):t=a;var s=u.DEFAULT_LOCALE;s=t!=u.DEFAULT_LOCALE?u.DEFAULT_LOCALE:u.ZH_LOCALE,console.log("newLocale = "+s),c.setLocalStorage(u.LOCALE_KEY,s),o.Config.setLocale(s,function(){console.log("refresh page"),o.Router.sync().then(function(){n("#globalBody").hide(),e.cleanNode(document.getElementById("globalBody")),e.applyBindings(new g,document.getElementById("globalBody")),n("#globalBody").show()},function(e){o.Logger.error("Error in root start: "+e.message)})})}}function d(o){o=o.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var e="[\\?&]"+o+"=([^&#]*)",n=new RegExp(e),t=n.exec(window.location.href);return null!==t&&t[1]}var p,f=o.Translations.getResource;o.ModuleBinding.defaults.modelPath="app/",o.ModuleBinding.defaults.viewPath="text!app/",r.init(),e.components.register("header-bar",{require:"app/components/header-bar/header-bar"}),i(function(t,s){if(t){try{console.log("Mobile app runs on platform "+s),a.moduleConfig.params.rootContext.platform=s;var i=function(){console.log("onlinecallback"),l.clearError(),a.moduleConfig.params.rootContext.isOnline=!0},r=function(){console.log("offlinecallback"),l.setError("ERROR_NETWORK_NOT_CONNECTED"),a.moduleConfig.params.rootContext.isOnline=!1},c=function(){console.log("pauseAppCallback"),a.moduleConfig.params.rootContext.isPause=!0},u=function(){console.log("pauseAppCallback"),a.moduleConfig.params.rootContext.isPause=!1};document.addEventListener("offline",r,!1),document.addEventListener("online",i,!1),document.addEventListener("resume",u,!1),document.addEventListener("pause",c,!1)}catch(o){console.error(o)}document.addEventListener("backbutton",function(o){document.getElementById("payment")||document.getElementById("springboard")||(document.getElementById("loginPage")?(o.preventDefault(),navigator.app.exitApp()):navigator.app.backAction?navigator.app.backAction(o):navigator.app.backHistory())},!1)}o.Router.defaults.urlAdapter=new o.Router.urlParamAdapter,o.Router.sync().then(function(){e.applyBindings(new g,document.getElementById("globalBody")),n("#globalBody").show()},function(e){o.Logger.error("Error in root start: "+e.message)})})});