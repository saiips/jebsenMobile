define(["ojs/ojcore","knockout","jquery","appController","util/dataService","pages/customer/customerService","util/appui","pages/common/constant","ojs/ojknockout","ojs/ojlistview","ojs/ojjsontreedatasource"],function(e,t,a,o,r,n,s,i){function l(){function r(){var e=o.moduleConfig.params.rootContext.selCustomerProfile;if("undefined"!=typeof e){var a=t.utils.unwrapObservable(e.outletName);t.utils.unwrapObservable(d.large())||a.length>i.TITLE_LENGTH&&(a=a.substring(0,i.TITLE_LENGTH)+"..."),d.headerTitle(a)}else d.headerTitle(d.lng_customerAddressList)}function n(){console.log("outLetList.js init() started")}function l(){for(var e=(t.utils.unwrapObservable(o.moduleConfig.params.rootContext.custId),o.moduleConfig.params.rootContext.selCustomerProfile.outletAddresses.children),a=[],r=[],n=0;n<e.length;n++){var i=e[n].attr.data.OUTLET_NAME.charAt(0).toUpperCase();r.indexOf(i)>-1?a[r.indexOf(i)].children.push({attr:{id:e[n].attr.data.SHIP_TO_SITE_ID,data:e[n].attr.data}}):(r.push(i),a.push({attr:{id:e[n].attr.data.SHIP_TO_SITE_ID,initial:i},children:[{attr:{id:e[n].attr.data.SHIP_TO_SITE_ID,data:e[n].attr.data}}]}))}a.sort(function(e,t){return e.attr.initial>t.attr.initial?1:e.attr.initial<t.attr.initial?-1:0}),a.forEach(function(e){e.children.sort(function(e,t){return e.attr.data.OUTLET_NAME>t.attr.data.OUTLET_NAME?1:e.attr.data.OUTLET_NAME<t.attr.data.OUTLET_NAME?-1:0})}),d.allOutlets(a),s.hideBusy()}function c(){var t=e.Translations.getTranslatedString;d.lng_searchPlaceHolder=t("ssa.header.search"),d.lng_customerAddressList=t("ssa.outletList.customerAddressList")}var d=this;d.router=o.router,d.handleActivated=function(t){d.searchText("");var a=t.valueAccessor().params.ojRouter.parentRouter;console.log("outletList.js parentRouter="+a.currentState().value);var n=a.getChildRouter("outletList");return n||(n=a.createChildRouter("outletList")),d.router=n.configure(function(t){if(t){var a=new e.RouterState(t,{value:t,enter:function(){d.currCustId(t),console.log("outletList.js stateId = "+t)}});return a}}),c(),r(),d.currCustId(o.moduleConfig.params.rootContext.custId),e.Router.sync()},d.handleAttached=function(e){},d.handleBindingsApplied=function(e){var t=a("#globalBody").find(".oj-hybrid-applayout-content"),o="oj-hybrid-applayout-scrollable";t.hasClass(o)&&(a("#searchCanvas").on("ojbeforeopen",function(){t.removeClass(o)}),a("#searchCanvas").on("ojbeforeclose",function(){t.addClass(o)})),a("#searchCanvas").on("ojclose",function(){d.clearSearch()})},d.handleDetached=function(e){},d.headerTitle=t.observable(),d.currCustId=t.observable(),d.allOutlets=t.observableArray(),d.searchText=t.observable(""),d.large=t.computed(function(){var t=e.ResponsiveUtils.getFrameworkQuery(e.ResponsiveUtils.FRAMEWORK_QUERY_KEY.LG_UP);return e.ResponsiveKnockoutUtils.createMediaQueryObservable(t)}),d.itemOnly=function(e){return e.leaf},d.selectTemplate=function(e,t){return t.$itemContext.leaf?"item_template":"group_template"},d.currCustId.subscribe(function(e){s.showBusy(),l(),s.hideBusy()}),d.outlets=t.computed(function(){if(d.searchText()&&d.allOutlets().length>0){var t=[],a=d.searchText().toLowerCase();return d.allOutlets().forEach(function(e){e.children.forEach(function(e){(e.attr.data.OUTLET_NAME.toLowerCase().indexOf(a)>=0||e.attr.data.SHIP_TO_ADDRESS.toLowerCase().indexOf(a)>=0)&&t.push(e)})}),new e.JsonTreeDataSource(t)}return new e.JsonTreeDataSource(d.allOutlets())}),d.onPageReady=function(){},d.onClearSearchText=function(){d.clearSearch()},d.clearSearch=function(){var e=a("#searchProduct");e.ojInputText("option","value",""),e.ojInputText("reset"),d.searchText("")},d.toggleSearchCanvas=function(){console.log("toggleSearchCanvas triggered"),e.OffcanvasUtils.toggle(u)},d.onSearchTextChange=function(e,t){"rawValue"===t.option&&(console.log("onSearchTextChange.data.value="+t.value),d.searchText(t.value))},d.dispose=function(e){d.router.dispose()},d.optionChange=function(e,t){"selection"===t.option&&t.value[0]&&(console.log("outletList.js outLetId ="+t.value),o.moduleConfig.params.rootContext.outLetId=t.value,o.moduleConfig.params.rootContext.navStateId="orderHist",o.redirect("orderHist",t.value))},n()}var u;return u={selector:"#searchCanvas",edge:"top",displayMode:"push",size:"63px",modality:"modeless",autoDismiss:"none"},t.bindingHandlers.searchCanvas={init:function(a,o,r){t.utils.domNodeDisposal.addDisposeCallback(a,function(){a&&e.OffcanvasUtils.close(u)})}},l});