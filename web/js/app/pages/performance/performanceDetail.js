define(["ojs/ojcore","knockout","jquery","appController","util/data","pages/performance/performanceService","util/appui","pages/common/constant","util/commonhelper","ojs/ojknockout","ojs/ojtabs","ojs/ojgauge","ojs/ojtable","ojs/ojarraytabledatasource"],function(e,r,a,o,n,t,s,l,c){function u(){function a(){console.log("performance.js init() started"),s.showBusy();var e=function(e,r){try{n(e,r.status)}catch(e){console.error(e)}finally{console.log("cbSuccessFn called")}},r=function(e,r){console.log("cbFailFn failed"),n(e,r.status)};t.getSalesPerformanceMessage(l()).then(e,r).then(function(){m.salesTarget(0),s.hideBusy()})}function n(e,r){try{if(null!==e&&200==r){var a,o=Array.isArray(e[i]);if(o)a=e[i];else{var n=new Array;n.push(e[i]),a=n}for(var t=[],s=0,l=0,c=0;c<a.length;c++)a[c].UOM||(a[c].UOM=""),s+=new Number(a[c].LAST_YTD_VOLUME),l+=new Number(a[c].THIS_YTD_VOLUME),t.push(a[c]);m.salePerformanceList(a),m.sumLastYtdVolume(s),m.sumThisYtdVolume(l)}}catch(e){console.error(e)}finally{console.log("cbSuccessFn called")}}function l(){var e=o.moduleConfig.params.rootContext.userProfile,r=JSON.stringify({InputGetSalesBySalesRep:{HeaderInfo:{UserID:e.username,UserRole:e.salesRole,CallerID:""},P_ORG_ID:e.orgUnitId,P_SALESREP_ID:e.erpSalesId}});return r}function u(){var r=c.getClientYesterday("DD-MMM-YYYY").toUpperCase(),a=e.Translations.getTranslatedString;m.lng_overdue=a("ssa.performance.overdue"),m.lng_salesPerformance=a("ssa.performance.salesPerformance"),m.lng_target=a("ssa.performance.target"),m.lng_performanceSummary=a("ssa.performance.performanceSummary")+" "+r,m.lng_performance=a("ssa.performance.performance"),m.lng_item=a("ssa.performance.item"),m.lng_lastYear=a("ssa.performance.lastYear"),m.lng_ytd=a("ssa.performance.ytd"),m.lng_volume=a("ssa.performance.volume"),m.lng_net=a("ssa.performance.net")}var m=this;console.log("PerformanceViewModel");var i="P_SALES_TBL_ITEM";m.router=o.router,m.salesTarget=r.observable(""),m.salePerformanceList=r.observableArray(),m.productPerformance=r.computed(function(){if(m.salePerformanceList().length>0)return new e.ArrayTableDataSource(m.salePerformanceList(),{idAttribute:"PRODUCT"})}),m.sumLastYtdVolume=r.observable(0),m.sumThisYtdVolume=r.observable(0),m.netLastYtdVolume=r.computed(function(){return m.salesTarget()-m.sumLastYtdVolume()}),m.netThisYtdVolume=r.computed(function(){return m.salesTarget()-m.sumThisYtdVolume()}),m.handleActivated=function(e){u()},m.handleAttached=function(e){},m.handleBindingsApplied=function(e){},m.handleDetached=function(e){},m.decimalNumberConverter=e.Validation.converterFactory("number").createConverter({style:"decimal",pattern:"#,##0"}),m.shortNumberConverter=e.Validation.converterFactory("number").createConverter({style:"decimal",decimalFormat:"short"}),a()}return u});