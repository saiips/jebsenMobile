define(["ojs/ojcore","knockout","jquery","appController","pages/modifier/modifierService","pages/common/cartService","pages/stockInquiry/stockInquiryService","util/appui","util/commonhelper","pages/common/constant","pages/common/maintenance","util/devmode","pages/common/logService","ojs/ojrouter","ojs/ojknockout","ojs/ojinputtext","ojs/ojbutton","ojs/ojinputnumber","ojs/ojselectcombobox","ojs/ojdatetimepicker","ojs/ojdialog","ojs/ojrouter","ojs/ojnavigationlist"],function(e,o,r,t,i,n,a,l,s,I,_,u,E){function d(){function u(){N.specialDiscountLoaded.removeAll(),N.specialAmountLoaded.removeAll(),N.promotionItemLoaded.removeAll()}function E(){console.log("init called"),l.showBusy(),N.isOrderDeskAdmin=o.computed(function(){var e=t.moduleConfig.params.rootContext.userProfile;try{return e.salesRole===I.SR_ADMIN}catch(e){return!1}}),N.isEnquiryMode=o.computed(function(){return t.moduleConfig.params.rootContext.enquiryMode}),console.log("isEnquiryMode="+N.isEnquiryMode()),u(),N.isOnline=o.computed(function(){return!!t.moduleConfig.params.rootContext.isOnline}),console.log("isMaintenance = "+_.isMaintenance()),console.log("isOnline = "+N.isOnline()),o.utils.arrayForEach(I.PROMOTION_NATURE_LIST,function(e){N.availablePromotionNature.push(o.toJS({value:e.value,label:e.label}))});var e=t.moduleConfig.params.rootContext.selectedItem;if(console.log("selectedItem = "+o.toJSON(e)),e){var r=e.product().prod_code();N.lng_modifier=N.lng_modifier+" : "+r}a.getPriceListMessage(m()).done(function(e){console.log("getPriceListMessage Done");var o=e,r=o.P_PRICE_LIST_TBL_ITEM;r.forEach(function(e){e.ITEM_CODE_DESCRIPTION=e.PRODUCT+" "+e.PRODUCT_DESCRIPTION});var t={};t.groupName="Item Code Suggestions",t.items=r,N.itemCodeSuggestions.push(t)}).then(function(){var e=t.moduleConfig.params.rootContext.selectedItem;console.log("cartItem = "+o.toJSON(e));var r=e.product().specialDiscount,i=e.product().specialAmount,n=e.product().promotionItem,a=o.utils.unwrapObservable(e.product().isFetchModifier);console.log("isFetchModifier="+a),a&&!N.isEnquiryMode()?(console.log("fetchModifier invoked"),T()):r&&r().length>0||i&&i().length>0||i&&n().length>0?(console.log("cachedModifier invoked"),c()):(console.log("cachedModifier invoked"),c())}).then(function(){console.log("fetch modifier done")})}function d(){var e=t.moduleConfig.params.rootContext.quotationId;e="undefined"!=typeof e&&"null"!=e&&e?e:null;var r=t.moduleConfig.params.rootContext.userProfile,n=t.moduleConfig.params.rootContext.selCustomerProfile,a=i.getOrderTypeId(r.orgUnitId),l=JSON.stringify({InputGetModifierDetails:{HeaderInfo:{UserID:r.username,UserRole:r.salesRole,CallerID:""},P_ORG_ID:r.orgUnitId,P_QUOTATION_ID:e,P_BILL_TO_SITE_ID:o.utils.unwrapObservable(n.billToSiteId),P_SHIP_TO_SITE_ID:o.utils.unwrapObservable(n.shipToSiteId),P_ORDER_TYPE_ID:a,P_ITEM_ID:N.currInventoryId(),P_ENQUIRY_MODE:null}});return l}function c(){var e=t.moduleConfig.params.rootContext.selectedItem;N.specialDiscountLoaded=e.product().specialDiscount,N.specialAmountLoaded=e.product().specialAmount,N.promotionItemLoaded=e.product().promotionItem,N.ready(!0),l.hideBusy()}function T(){var e=d();console.log("get modifier payload ="+o.toJS(e));var r=function(e,o){try{O(e,o.status)}catch(e){console.error(e)}finally{N.ready(!0),l.hideBusy(),console.log("cbSuccessFn called")}},t=function(e,o){console.log("cbFailFn failed"),O(e,o.status),N.ready(!0),l.hideBusy()};i.getModifierMessage(e).then(r,t)}function O(e,r){if(console.log("raw data="+o.toJSON(e)),e=Array.isArray(e)?e[0]:e,null!==e&&200==r)for(var t=e[f].O_MODIFIER_TBL_ITEM,i=t.length,n=0;n<i;n++)R(t[n],e)}function R(e,t){console.log("populate modifier data = "+o.toJSON(e));var i=0,a=e.MODIFIER_TYPE;try{a==I.MODIFIER_TYPE_ITEM?i=N.promotionItemLoaded().length:a==I.MODIFIER_TYPE_DISCOUNT?i=N.specialDiscountLoaded().length:a==I.MODIFIER_TYPE_AMOUNT&&(i=N.specialAmountLoaded().length)}catch(e){}var l="Y"==e.FROM_STAGING&&e.MODIFIER_NUMBER&&"-1"!=e.MODIFIER_NUMBER?"Y":"N",_="Y"==e.FROM_STAGING&&e.MODIFIER_NUMBER&&"-1"!=e.MODIFIER_NUMBER?"Y":"N";_=N.isEnquiryMode()?"N":_;var u=s.formatStrDate(e.MODIFIER_START_DATE,"YYYY-MM-DDTHH:mm:ss.sssZ","DD-MMM-YYYY").toUpperCase();u==I.BLANK_DATE&&(e.MODIFIER_START_DATE="");var E=s.formatStrDate(e.MODIFIER_END_DATE,"YYYY-MM-DDTHH:mm:ss.sssZ","DD-MMM-YYYY").toUpperCase();E==I.BLANK_DATE&&(e.MODIFIER_END_DATE="");var d="N"==e.FROM_STAGING?"N":"Y";N.isEnquiryMode()&&(d="N");var c={id:i+1,MODIFIER_NUMBER:"-1"==e.MODIFIER_NUMBER?null:e.MODIFIER_NUMBER,FROM_STAGING:e.FROM_STAGING,MODIFIER_TYPE:e.MODIFIER_TYPE,MODIFIER_ITEM_ID:e.MODIFIER_ITEM_ID,MODIFIER_VALUE_FROM:"-1"==e.MODIFIER_VALUE_FROM?null:e.MODIFIER_VALUE_FROM,GET_ITEM_ID:"-1"==e.GET_ITEM_ID?null:e.GET_ITEM_ID,GET_ITEM_NUMBER:"-1"==e.GET_ITEM_NUMBER?null:e.GET_ITEM_NUMBER,GET_QUANTITY:"-1"==e.GET_QUANTITY?null:e.GET_QUANTITY,GET_PRICE:"-1"==e.GET_PRICE?null:e.GET_PRICE,GET_PROMOTION_NATURE:"-1"==e.GET_PROMOTION_NATURE?null:e.GET_PROMOTION_NATURE,GET_PERCENT:"-1"==e.GET_PERCENT?null:e.GET_PERCENT,MODIFIER_START_DATE:e.MODIFIER_START_DATE,MODIFIER_END_DATE:e.MODIFIER_END_DATE,MODIFIER_SHIP_TO:"-1"==e.MODIFIER_SHIP_TO?null:e.MODIFIER_SHIP_TO,SHOW_LINK_BTN:l,SHOW_REMOVE_BTN:_,ENABLE_SHIP_TO:d},T="Y"==e.FROM_STAGING||!e.MODIFIER_NUMBER||"-1"==e.MODIFIER_NUMBER;console.log("isModified="+T);var O=!1,R=n.createModifier(c,T);T||r.each(t.O_MODIFIER_TBL.O_MODIFIER_TBL_ITEM,function(o,r){r.MODIFIER_NUMBER==e.MODIFIER_NUMBER&&"-1"!=e.MODIIFER_NUMBER&&"Y"==r.FROM_STAGING&&(O=!0)}),console.log("isFilterRecord="+O),a==I.MODIFIER_TYPE_ITEM?O?N.promotionItemFiltered.push(R):N.promotionItemLoaded.push(R):a==I.MODIFIER_TYPE_DISCOUNT?O?N.specialDiscountFiltered.push(R):N.specialDiscountLoaded.push(R):a==I.MODIFIER_TYPE_AMOUNT&&(O?N.specialAmountFiltered.push(R):N.specialAmountLoaded.push(R))}function M(e){var o=/^\d+$/;return o.test(e)}function D(){var e=o.utils.arrayFirst(N.promotionItemLoaded(),function(e){var r=e.GET_ITEM_ID();if(Array.isArray(r)&&(r=r[0]),!r)return e;if(!M(r))return e;var t=o.utils.arrayFirst(N.itemCodeSuggestions()[0].items,function(e){if(e.INVENTORY_ITEM_ID==r)return e});return t?null:e});if(e)return console.log("found error item = "+o.toJSON(e)),l.hideBusy(),l.showMessageBox(N.lng_error_00042),!0;var e=o.utils.arrayFirst(N.promotionItemLoaded(),function(e){var r=o.utils.unwrapObservable(e.MODIFIER_START_DATE),t=o.utils.unwrapObservable(e.MODIFIER_END_DATE);if(!r||!t||t<r)return e});if(e)return l.hideBusy(),l.showMessageBox(N.lng_error_00044),!0;var e=o.utils.arrayFirst(N.specialDiscountLoaded(),function(e){var r=o.utils.unwrapObservable(e.MODIFIER_START_DATE),t=o.utils.unwrapObservable(e.MODIFIER_END_DATE);if(!r||!t||t<r)return e});if(e)return l.hideBusy(),l.showMessageBox(N.lng_error_00044),!0;var e=o.utils.arrayFirst(N.specialAmountLoaded(),function(e){var r=o.utils.unwrapObservable(e.MODIFIER_START_DATE),t=o.utils.unwrapObservable(e.MODIFIER_END_DATE);if(!r||!t||t<r)return e});return!!e&&(l.hideBusy(),l.showMessageBox(N.lng_error_00045),!0)}function m(){var e,e,o=t.moduleConfig.params.rootContext.userProfile,r=t.moduleConfig.params.rootContext.userProfile.orgUnitId,i=[],n=[];o.salesRole===I.SR_SALE_VAN?e=I.PRICE_ID_BEER:o.salesRole!==I.SR_MOBILE_SALE&&o.salesRole!==I.SR_ADMIN||(o.orgUnitId===I.ORG_UNIT_ID_WINE?e=I.PRICE_ID_WINE:o.orgUnitId===I.ORG_UNIT_ID_BEER&&(e=I.PRICE_ID_BEER)),i.push(e);for(var a=0;a<i.length;a++)n.push({PRICE_LIST_ID:i[a]});var l=JSON.stringify({InputGetPriceList:{HeaderInfo:{UserID:o.username,UserRole:o.salesRole,CallerID:""},P_ORG_ID:r,P_PRICE_LIST_ID_TBL:{P_PRICE_LIST_ID_TBL_ITEM:n}}});return l}function p(){var o=e.Translations.getTranslatedString;N.lng_modifier=o("ssa.modifier.modifier"),N.lng_history=o("ssa.modifier.history"),N.lng_addBtn=o("ssa.modifier.addBtn"),N.lng_shipTo=o("ssa.modifier.shipTo"),N.lng_confirmBtn=o("ssa.modifier.confirmBtn"),N.lng_cancelBtn=o("ssa.modifier.cancelBtn"),N.lng_discountUnit=o("ssa.modifier.discountUnit"),N.lng_amountUnit=o("ssa.modifier.amountUnit"),N.lng_specialDiscount=o("ssa.modifier.specialDiscount"),N.lng_specialAmount=o("ssa.modifier.specialAmount"),N.lng_promotionItem=o("ssa.modifier.promotionItem"),N.lng_buyQty=o("ssa.modifier.buyQty"),N.lng_start=o("ssa.modifier.start"),N.lng_end=o("ssa.modifier.end"),N.lng_getItem=o("ssa.modifier.getItem"),N.lng_getQty=o("ssa.modifier.getQty"),N.lng_unitPrice=o("ssa.modifier.unitPrice"),N.lng_promotionNature=o("ssa.modifier.promotionNature"),N.lng_maintenance=o("ssa.msg.info.maintenance"),N.lng_placeholder=o("ssa.stockSearch.inputItemCode"),N.lng_from=o("ssa.modifier.from"),N.lng_to=o("ssa.modifier.to"),N.lng_error_00042=o("ssa.msg.error.ERROR_00042"),N.lng_error_00043=o("ssa.msg.error.ERROR_00043"),N.lng_error_00044=o("ssa.msg.error.ERROR_00044"),N.lng_error_00045=o("ssa.msg.error.ERROR_00045")}var N=this,f="O_MODIFIER_TBL";N.router=t.router,console.log("ModifierViewModel"),N.ready=o.observable(!1),N.currInventoryId=o.observable(),N.headerTitle=o.observable(""),N.specialDiscountLoaded=o.observableArray(),N.specialDiscountFiltered=o.observableArray(),N.specialAmountLoaded=o.observableArray(),N.specialAmountFiltered=o.observableArray(),N.promotionItemLoaded=o.observableArray(),N.promotionItemFiltered=o.observableArray(),N.availablePromotionNature=o.observableArray(),N.cart=o.observableArray(),N.modifierType=o.observable(),N.dialogItem=o.observableArray(),N.dialogTemplateName=o.computed(function(){var e="dialog_promotion_item_template";return N.modifierType()==I.MODIFIER_TYPE_ITEM?e="dialog_promotion_item_template":N.modifierType()==I.MODIFIER_TYPE_DISCOUNT?e="dialog_special_discount_template":N.modifierType()==I.MODIFIER_TYPE_AMOUNT&&(e="dialog_special_amount_template"),e}),N.dataFormat=o.observable("yyyy/MM/dd");var g=e.Validation.converterFactory("datetime");N.dateConverter=g.createConverter({pattern:N.dataFormat()}),N.allowAdd=o.computed(function(){return!0}),N.addSpecialDiscount=function(e,o){console.log("addSpecialDiscount clicked");var r=s.getClientCurrentDate("YYYY-MM-DD"),t=0;try{t=N.specialDiscountLoaded().length}catch(e){}var i={id:t+1,MODIFIER_NUMBER:null,FROM_STAGING:"N",MODIFIER_TYPE:I.MODIFIER_TYPE_DISCOUNT,MODIFIER_ITEM_ID:N.currInventoryId(),MODIFIER_VALUE_FROM:null,GET_ITEM_NUMBER:null,GET_QUANTITY:null,GET_PRICE:null,GET_PROMOTION_NATURE:null,GET_PERCENT:0,MODIFIER_START_DATE:r,MODIFIER_END_DATE:r,MODIFIER_SHIP_TO:"N",SHOW_LINK_BTN:"N",SHOW_REMOVE_BTN:"Y",ENABLE_SHIP_TO:"Y"},a=n.createModifier(i,!0);N.specialDiscountLoaded.push(a)},N.removeSpecialDiscountLine=function(e){N.specialDiscountLoaded.remove(e)},N.addSpecialAmount=function(e,o){console.log("addSpecialAmount clicked");var r=s.getClientCurrentDate("YYYY-MM-DD"),t=0;try{t=N.specialAmountLoaded().length}catch(e){}var i={id:t+1,MODIFIER_NUMBER:null,FROM_STAGING:"N",MODIFIER_TYPE:I.MODIFIER_TYPE_AMOUNT,MODIFIER_ITEM_ID:N.currInventoryId(),MODIFIER_VALUE_FROM:null,GET_ITEM_NUMBER:null,GET_QUANTITY:null,GET_PRICE:0,GET_PROMOTION_NATURE:null,GET_PERCENT:null,MODIFIER_START_DATE:r,MODIFIER_END_DATE:r,MODIFIER_SHIP_TO:"N",SHOW_LINK_BTN:"N",SHOW_REMOVE_BTN:"Y",ENABLE_SHIP_TO:"Y"},a=n.createModifier(i,!0);N.specialAmountLoaded.push(a)},N.removeSpecialAmountLine=function(e){N.specialAmountLoaded.remove(e)},N.addPromotionItem=function(e,o){console.log("addPromotionItem clicked");var r=s.getClientCurrentDate("YYYY-MM-DD"),t=0;try{t=N.promotionItemLoaded().length}catch(e){}var i={id:t+1,MODIFIER_NUMBER:null,FROM_STAGING:"N",MODIFIER_TYPE:I.MODIFIER_TYPE_ITEM,MODIFIER_ITEM_ID:N.currInventoryId(),MODIFIER_VALUE_FROM:"1",GET_ITEM_ID:N.currInventoryId(),GET_ITEM_NUMBER:null,GET_QUANTITY:"1",GET_PRICE:"0",GET_PROMOTION_NATURE:I.PROMOTION_NATURE_AP,GET_PERCENT:null,MODIFIER_START_DATE:r,MODIFIER_END_DATE:r,MODIFIER_SHIP_TO:"N",SHOW_LINK_BTN:"N",SHOW_REMOVE_BTN:"Y",ENABLE_SHIP_TO:"Y"},a=n.createModifier(i,!0);N.promotionItemLoaded.push(a)},N.removePromotionItemLine=function(e){N.promotionItemLoaded.remove(e)},N.handleActivated=function(r){var i=r.valueAccessor().params.ojRouter.parentRouter;console.log("modifier.js parentRouter="+i.currentState().value);var n=i.getChildRouter("modifier");n||(n=i.createChildRouter("modifier")),N.router=n.configure(function(o){if(o){var r=new e.RouterState(o,{value:o,enter:function(){N.currInventoryId(o),console.log("modifier.js stateId ="+o)}});return r}});var a=t.moduleConfig.params.rootContext.selCustomerProfile;if("undefined"!=typeof a){var l=o.utils.unwrapObservable(a.outletName);o.utils.unwrapObservable(N.large())||l.length>I.TITLE_LENGTH&&(l=l.substring(0,I.TITLE_LENGTH)+"..."),N.headerTitle(l)}else N.headerTitle("");return p(),E(),e.Router.sync()},N.currInventoryId.subscribe(function(e){console.log("newInventoryId="+e)}),N.large=o.computed(function(){var o=e.ResponsiveUtils.getFrameworkQuery(e.ResponsiveUtils.FRAMEWORK_QUERY_KEY.LG_UP);return e.ResponsiveKnockoutUtils.createMediaQueryObservable(o)}),N.itemCodeSuggestions=o.observableArray(),N.dispose=function(e){N.router.dispose()},N.goBack=function(e,o){console.log("goBack clicked");var r=t.moduleConfig.params.rootContext.quotationId;N.isEnquiryMode()?t.redirect("quotationDetail",r):(t.moduleConfig.params.rootContext.fromModifier="Y",t.redirect("checkOutQuotation",r))},N.openDetail=function(e,t,i){if(e){var n=o.utils.unwrapObservable(e.MODIFIER_TYPE),a=o.utils.unwrapObservable(e.MODIFIER_NUMBER),l=null;console.log("copy data = "+o.toJSON(e)),n==I.MODIFIER_TYPE_ITEM?(l=o.utils.arrayFirst(N.promotionItemFiltered(),function(e){return a==o.utils.unwrapObservable(e.MODIFIER_NUMBER)}),N.modifierType(new String(I.MODIFIER_TYPE_ITEM))):n==I.MODIFIER_TYPE_DISCOUNT?(l=o.utils.arrayFirst(N.specialDiscountFiltered(),function(e){return a==o.utils.unwrapObservable(e.MODIFIER_NUMBER)}),N.modifierType(new String(I.MODIFIER_TYPE_DISCOUNT))):n==I.MODIFIER_TYPE_AMOUNT&&(l=o.utils.arrayFirst(N.specialAmountFiltered(),function(e){return a==o.utils.unwrapObservable(e.MODIFIER_NUMBER)}),N.modifierType(new String(I.MODIFIER_TYPE_AMOUNT))),console.log("foundItem = "+o.toJSON(l)),console.log("modifierType = "+o.utils.unwrapObservable(N.modifierType)),N.dialogItem.removeAll(),N.dialogItem.push(l),r("#scrollingDialog").ojDialog("open")}},N.dirty=function(e){var r=function(){},t=o.observable(e);return r.isDirty=o.computed(function(){return e}),r.reset=function(){t(!1)},r},N.confirm=function(e,r){console.log("confirm clicked"),l.showBusy();var i=t.moduleConfig.params.rootContext.selectedItem;i.product().specialDiscount=N.specialDiscountLoaded,i.product().specialAmount=N.specialAmountLoaded,i.product().promotionItem=N.promotionItemLoaded,i.product().isFetchModifier(!1),console.log("cartItem = "+o.toJSON(i)),o.utils.arrayForEach(i.product().promotionItem(),function(e){console.log("isDirty()="+e.dirtyFlag.isDirty()),e.dirtyFlag.isDirty()||e.ORIGINAL_MODIFIER_VALUE_FROM==o.utils.unwrapObservable(e.MODIFIER_VALUE_FROM)&&e.ORIGINAL_GET_ITEM_ID==o.utils.unwrapObservable(e.GET_ITEM_ID)&&e.ORIGINAL_GET_QUANTITY==o.utils.unwrapObservable(e.GET_QUANTITY)&&e.ORIGINAL_GET_PRICE==o.utils.unwrapObservable(e.GET_PRICE)&&e.ORIGINAL_GET_PROMOTION_NATURE==o.utils.unwrapObservable(e.GET_PROMOTION_NATURE)&&e.ORIGINAL_GET_PERCENT==o.utils.unwrapObservable(e.GET_PERCENT)&&e.ORIGINAL_MODIFIER_START_DATE==o.utils.unwrapObservable(e.MODIFIER_START_DATE)&&e.ORIGINAL_MODIFIER_END_DATE==o.utils.unwrapObservable(e.MODIFIER_END_DATE)&&e.ORIGINAL_MODIFIER_SHIP_TO==o.utils.unwrapObservable(e.MODIFIER_SHIP_TO)||(console.log("promotion item="+o.toJSON(e)),console.log("Found Difference: to update the dirtyFlag = true"),e.dirtyFlag=new N.dirty(!0))}),o.utils.arrayForEach(i.product().specialAmount(),function(e){console.log("isDirty()="+e.dirtyFlag.isDirty()),e.dirtyFlag.isDirty()||e.ORIGINAL_MODIFIER_VALUE_FROM==o.utils.unwrapObservable(e.MODIFIER_VALUE_FROM)&&e.ORIGINAL_GET_ITEM_ID==o.utils.unwrapObservable(e.GET_ITEM_ID)&&e.ORIGINAL_GET_QUANTITY==o.utils.unwrapObservable(e.GET_QUANTITY)&&e.ORIGINAL_GET_PRICE==o.utils.unwrapObservable(e.GET_PRICE)&&e.ORIGINAL_GET_PROMOTION_NATURE==o.utils.unwrapObservable(e.GET_PROMOTION_NATURE)&&e.ORIGINAL_GET_PERCENT==o.utils.unwrapObservable(e.GET_PERCENT)&&e.ORIGINAL_MODIFIER_START_DATE==o.utils.unwrapObservable(e.MODIFIER_START_DATE)&&e.ORIGINAL_MODIFIER_END_DATE==o.utils.unwrapObservable(e.MODIFIER_END_DATE)&&e.ORIGINAL_MODIFIER_SHIP_TO==o.utils.unwrapObservable(e.MODIFIER_SHIP_TO)||(console.log("special amount item="+o.toJSON(e)),console.log("Found Difference: to update the dirtyFlag = true"),e.dirtyFlag=new N.dirty(!0))}),o.utils.arrayForEach(i.product().specialDiscount(),function(e){console.log("isDirty()="+e.dirtyFlag.isDirty()),e.dirtyFlag.isDirty()||e.ORIGINAL_MODIFIER_VALUE_FROM==o.utils.unwrapObservable(e.MODIFIER_VALUE_FROM)&&e.ORIGINAL_GET_ITEM_ID==o.utils.unwrapObservable(e.GET_ITEM_ID)&&e.ORIGINAL_GET_QUANTITY==o.utils.unwrapObservable(e.GET_QUANTITY)&&e.ORIGINAL_GET_PRICE==o.utils.unwrapObservable(e.GET_PRICE)&&e.ORIGINAL_GET_PROMOTION_NATURE==o.utils.unwrapObservable(e.GET_PROMOTION_NATURE)&&e.ORIGINAL_GET_PERCENT==o.utils.unwrapObservable(e.GET_PERCENT)&&e.ORIGINAL_MODIFIER_START_DATE==o.utils.unwrapObservable(e.MODIFIER_START_DATE)&&e.ORIGINAL_MODIFIER_END_DATE==o.utils.unwrapObservable(e.MODIFIER_END_DATE)&&e.ORIGINAL_MODIFIER_SHIP_TO==o.utils.unwrapObservable(e.MODIFIER_SHIP_TO)||(console.log("special discount item="+o.toJSON(e)),console.log("Found Difference: to update the dirtyFlag = true"),e.dirtyFlag=new N.dirty(!0))});var a=D();if(!a){N.cart=n.getCart(N.cart);var s=N.cart.indexOf(t.moduleConfig.params.rootContext.selectedItem);N.cart.splice(s,1,i),t.moduleConfig.params.rootContext.originalQuotationCart=o.observableArray(),o.utils.arrayMap(N.cart(),function(e){t.moduleConfig.params.rootContext.originalQuotationCart.push(e)}),t.moduleConfig.params.rootContext.fromModifier="Y",l.hideBusy();var I=t.moduleConfig.params.rootContext.quotationId;t.redirect("checkOutQuotation",I)}},N.cancel=function(e,o){N.goBack()},N.onSearchTextChange=function(e,o){"rawValue"===o.option&&console.log("data.value = "+o.value)},N.onClearSearchText=function(e,o,r){N.clearSearch(e,o,r)},N.clearSearch=function(e,t,i){var n=N.promotionItemLoaded.indexOf(e);if(n>=0){e.GET_ITEM_ID=o.observable(null),N.promotionItemLoaded.splice(n,1,e);var a=n+1;r("#oj-inputsearch-input-itemCode-"+a).val("")}}}return o.bindingHandlers.winsize={init:function(e,o,t,i,n){r(window).resize(function(){i.screenWidth(r(window).width()),i.screenHeight(r(window).height())})}},o.bindingHandlers.currency={symbol:o.observable("$"),update:function(e,r,t){return o.bindingHandlers.text.update(e,function(){var e=+(o.utils.unwrapObservable(r())||0),i=o.utils.unwrapObservable(void 0===t().symbol?t().sybmol:"$");return i+e.toFixed(2).replace(/(\d)(?=(\d{3})+\.)/g,"$1,")})}},o.bindingHandlers.readOnly={update:function(e,r){var t=o.utils.unwrapObservable(r());t?e.setAttribute("readOnly",!0):e.removeAttribute("readOnly")}},d});