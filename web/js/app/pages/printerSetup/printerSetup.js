define(["ojs/ojcore","knockout","jquery","appController","util/appui","pages/common/constant","pages/printerSetup/printerService","ojs/ojknockout","hammerjs","ojs/ojjquery-hammer","ojs/ojrouter","ojs/ojtoolbar","ojs/ojinputtext","ojs/ojbutton","ojs/ojmodel","ojs/ojoffcanvas"],function(o,e,n,r,t,a,s){function i(){function n(){t.showBusy(),console.log("printerSetup.js init() started");var o=t.getLocalStorage(a.PRINTER_MAC_ADDRESS);o&&c.mac(o),s.getAllPrintersMessage().then(function(o){try{var n=o.items;n&&(Array.isArray(n)||(n=new Array(n)),c.availablePrinters().length<=0&&(c.availablePrinters.push(e.toJS({value:"-1",label:""})),e.utils.arrayForEach(n,function(o){c.availablePrinters.push(e.toJS({value:o.mac,label:o.model}))})))}catch(o){}}).done(function(){console.log("completed"),t.hideBusy()})}function i(){try{cordova.plugins.zbtprinter.find(function(o){if(console.log("result = "+e.toJSON(o)),o.friendlyName){var n=o.friendlyName.indexOf("XXXXJ");n>=0&&(console.log("Found the printer"),console.log("address = "+o.address),console.log("friendly name = "+o.friendlyName),c.mac(o.address),t.hideBusy())}},function(o){console.log("try failed"),t.hideBusy()})}catch(o){console.log("findPrinterMac Exception : "+o),t.hideBusy()}finally{}}function l(){var e=o.Translations.getTranslatedString;c.lng_macAddress=e("ssa.printerSetup.macAddress"),c.lng_find=e("ssa.printerSetup.find"),c.lng_error_00037=e("ssa.msg.error.ERROR_00037"),c.lng_title=e("ssa.springboard.printerSetup"),c.lng_reset=e("ssa.reviewLoading.reset")}var c=this;c.mac=e.observable(""),c.availablePrinters=e.observableArray(),c.handleActivated=function(o){l(),n()},c.handleAttached=function(o){},c.handleBindingsApplied=function(o){},c.handleDetached=function(o){},c.findPrinter=function(){c.mac(null),t.showBusy();var o=r.moduleConfig.params.rootContext.isCordova;return o?void c.asyncLoop({length:50,functionToLoop:function(o,e){setTimeout(function(){console.log("Iteration "+e),i(),o()},1e3)},callback:function(){console.log("all done!"),t.hideBusy()}}):(t.hideBusy(),void t.showMessageBox(c.lng_error_00037))},c.asyncLoop=function(o){var e=-1,n=function(){return e++,e==o.length||c.mac()?(e==o.length&&t.showMessageBox(c.lng_error_00037),void o.callback()):void o.functionToLoop(n,e)};n()},c.reset=function(){c.mac("")},c.mac.subscribe(function(o){console.log("mac = "+o),Array.isArray(o)&&(o=o[0]),o="-1"==o?null:o,o=o?o.toString().trim():o,r.moduleConfig.params.rootContext.macAddress=o,t.setLocalStorage(a.PRINTER_MAC_ADDRESS,o);var n=e.utils.arrayFirst(c.availablePrinters(),function(n){return e.utils.unwrapObservable(n.value)==o});n&&(console.log("model="+n.label),r.moduleConfig.params.rootContext.serialNo=n.label,t.setLocalStorage(a.PRINTER_SERIAL_NO,n.label))}),c.goBack=function(){r.go("springboard")}}return new i});