define(["ojs/ojcore","knockout","jquery","appController","pages/newOrder/newOrderService","pages/common/cartService","util/appui","pages/common/constant","promise","ojs/ojlistview","ojs/ojjsontreedatasource","ojs/ojpagingcontrol","ojs/ojnavigationlist","ojs/ojrouter","ojs/ojtoolbar","ojs/ojinputtext","ojs/ojbutton","ojs/ojinputnumber","ojs/ojarraytabledatasource","ojs/ojpulltorefresh","ojs/ojvalidation","ojs/ojoffcanvas"],function(e,r,o,t,a,n,i,s){function l(){function a(){console.log("newOrder.js init() started");var e=t.moduleConfig.params.rootContext.originalCart;console.log("originalCart = "+r.toJSON(e)),console.log("isArray(originalCart) = "+Array.isArray(e)),Array.isArray(e)||(e=r.utils.unwrapObservable(e)),c.totalCnt(e.length),c.allProduct(e),c.ready(!0)}function l(){return t.moduleConfig.params.rootContext.isDataSync}function u(){var r=e.Translations.getTranslatedString;c.lng_newOrder=r("ssa.newOrder.newOrder"),c.lng_qty=r("ssa.newOrder.qty"),c.lng_itemList=r("ssa.newOrder.itemList"),c.lng_topList=r("ssa.newOrder.topList"),c.lng_orderList=r("ssa.newOrder.orderList"),c.lng_searchPlaceHolderText=r("ssa.newOrder.searchPlaceHolder"),c.lng_noItemCart=r("ssa.msg.info.noItemCart")}var c=this;u(),c.handleActivated=function(o){var a=o.valueAccessor().params.ojRouter.parentRouter;console.log("newOrder.js parentRouter="+a.currentState().value);var n=a.getChildRouter("newOrder");n||(n=a.createChildRouter("newOrder")),c.router=n.configure(function(r){if(r){var o=new e.RouterState(r,{value:r,enter:function(){c.currOrderId(r),console.log("stateId ="+r)}});return o}}),c.headerSubTitle(c.lng_newOrder);var i=t.moduleConfig.params.rootContext.selCustomerProfile;if("undefined"!=typeof i){var l=r.utils.unwrapObservable(i.outletName);r.utils.unwrapObservable(c.large())||l.length>s.TITLE_LENGTH&&(l=l.substring(0,s.TITLE_LENGTH)+"..."),c.headerTitle(l)}else c.headerTitle("");return c.newOrderNavStateId(t.moduleConfig.params.rootContext.newOrderNavStateId),e.Router.sync()},console.log("NewOrderViewModoel"),c.router=t.router,c.allProduct=r.observableArray(),c.ready=r.observable(!1),c.cart=r.observableArray(),c.currOrderId=r.observable(),c.headerTitle=r.observable(""),c.headerSubTitle=r.observable(""),c.totalCnt=r.observable(0),c.large=r.computed(function(){var r=e.ResponsiveUtils.getFrameworkQuery(e.ResponsiveUtils.FRAMEWORK_QUERY_KEY.LG_UP);return e.ResponsiveKnockoutUtils.createMediaQueryObservable(r)}),c.newOrderNavDataSource=r.computed(function(){var r=[{name:c.lng_itemList,id:"newOrderItem",iconClass:"oj-navigationlist-item-icon demo-icon demo-dashboard-icon"},{name:c.lng_topList,id:"topOrderItem",iconClass:"oj-navigationlist-item-icon demo-icon demo-dashboard-icon"},{name:c.lng_orderList,id:"newOrder",iconClass:"oj-navigationlist-item-icon demo-icon demo-incidents-icon"}];return new e.ArrayTableDataSource(r,{idAttribute:"id"})}),c.newOrderNavChangeHandler=t.newOrderNavChangeHandler,c.newOrderNavStateId=r.observable(),c.searchText=r.observable(""),c.lng_searchPlaceHolder=r.observable(c.lng_searchPlaceHolderText),c.searchText.extend({rateLimit:{timeout:500,method:"notifyWhenChangesStop"}}),c.products=r.computed(function(){var o=c.searchText().toLowerCase();if(c.searchText()&&c.allProduct().length>0){var t=r.utils.arrayFilter(c.allProduct(),function(e){return e.product().prod_desc().toLowerCase().indexOf(o)>=0||e.product().prod_code().toLowerCase().indexOf(o)>=0||e.product().prod_brand().toLowerCase().indexOf(o)>=0});return new e.ArrayTableDataSource(t,{idAttribute:"id"})}return new e.ArrayTableDataSource(c.allProduct(),{idAttribute:"id"})}),c.handleBindingsApplied=function(e){var r=o("#globalBody").find(".oj-hybrid-applayout-content"),t="oj-hybrid-applayout-scrollable";r.hasClass(t)&&(o("#searchCanvas").on("ojbeforeopen",function(){r.removeClass(t)}),o("#searchCanvas").on("ojbeforeclose",function(){r.addClass(t)})),o("#searchCanvas").on("ojclose",function(){c.clearSearch()})},c.onClearSearchText=function(){c.clearSearch()},c.clearSearch=function(){var e=o("#searchProduct");e.ojInputText("option","value",""),e.ojInputText("reset"),c.searchText("")},c.toggleSearchCanvas=function(){e.OffcanvasUtils.toggle(d)},c.onSearchTextChange=function(e,r){"rawValue"===r.option&&c.searchText(r.value)},c.removeCart=function(e){var o=r.utils.unwrapObservable(e.id),a=r.utils.unwrapObservable(e.quantity),n=r.utils.arrayFirst(c.allProduct(),function(e){var t=r.utils.unwrapObservable(e.id),n=r.utils.unwrapObservable(e.quantity);if(t==o&&n==a)return e});c.allProduct.remove(n),n&&c.totalCnt(r.utils.unwrapObservable(c.totalCnt())-1),t.moduleConfig.params.rootContext.originalCart=r.utils.unwrapObservable(c.allProduct)},c.checkOut=function(e,r){t.moduleConfig.params.rootContext.fromPage="newOrder";var o=t.moduleConfig.params.rootContext.custId,a=n.allowCheckOut(t.moduleConfig.params.rootContext.originalCart);a?t.redirect("checkOut",o):i.showMessageBox(c.lng_noItemCart)},c.goBack=function(e,o){console.log("goBack clicked");var a=t.moduleConfig.params.rootContext.fromPage;if(l()||"orderHist"!==a&&"newOrder"!==a&&"newOrderItem"!==a){var n=r.utils.unwrapObservable(c.currOrderId);t.redirect("orderDetail",n)}else{var i=t.moduleConfig.params.rootContext.custId;t.redirect("orderHist",i)}},c.dispose=function(e){c.router.dispose()},c.onPageReady=function(){},a()}var d;return d={selector:"#searchCanvas",edge:"top",displayMode:"push",size:"63px",modality:"modeless",autoDismiss:"none"},r.bindingHandlers.searchCanvas={init:function(o,t,a){r.utils.domNodeDisposal.addDisposeCallback(o,function(){o&&e.OffcanvasUtils.close(d)})}},r.bindingHandlers.winsize={init:function(e,r,t,a,n){o(window).resize(function(){a.screenWidth(o(window).width()),a.screenHeight(o(window).height())})}},r.bindingHandlers.currency={symbol:r.observable("$"),update:function(e,o,t){return r.bindingHandlers.text.update(e,function(){var e=+(r.utils.unwrapObservable(o())||0),a=r.utils.unwrapObservable(void 0===t().symbol?t().sybmol:"$");return a+e.toFixed(2).replace(/(\d)(?=(\d{3})+\.)/g,"$1,")})}},l});