define(["ojs/ojcore","knockout","jquery","appController","util/appui","pages/reviewLoading/reviewLoadingService","pages/common/constant","util/commonhelper","pages/common/maintenance","ojs/ojrouter","ojs/ojknockout","ojs/ojinputtext","ojs/ojbutton","ojs/ojinputnumber","ojs/ojselectcombobox","ojs/ojdatetimepicker","ojs/ojlistview","ojs/ojmodel","ojs/ojpagingcontrol","ojs/ojpagingcontrol-model","ojs/ojdialog","ojs/ojnavigationlist","ojs/ojtable","ojs/ojdatacollection-utils","ojs/ojarraytabledatasource","ojs/ojdatasource-common","promise","ojs/ojrowexpander","ojs/ojflattenedtreedatagriddatasource","ojs/ojjsontreedatasource","ojs/ojvalidation","ojs/ojoffcanvas","ojs/ojpopup"],function(e,o,a,r,s,n,t,_,l){function E(){function E(){console.log("reviewLoading init(): started"),R(),u(),O.allLoaded.removeAll()}function u(){var e=moment().add(-1,"M").format("YYYY-MM-DD"),o=_.getClientCurrentDate("YYYY-MM-DD");O.fromDate(e),O.toDate(o),O.documentNo(null),O.orderNo(null),O.customerNo(null),O.customerName(null)}function I(e,a){if(e=Array.isArray(e)?e[0]:e,console.log("Date retrieve from backend = "+o.toJSON(e)),null!==e&&200==a){var r=[],n=0,l=e[c],E=l.P_RETURN_STATUS;if("S"!=E)return void s.showMessageBox(O.lng_error_00031);if(!l.P_INTF_TBL_O)return void O.allLoaded(r);var i=l.P_INTF_TBL_O.P_INTF_TBL_I_ITEM;if(!i)return void s.showMessageBox(O.lng_error_00031);console.log("resultJSON.length="+i.length),o.utils.arrayMap(i,function(e){try{var a=_.formatStrDate(e.DOCUMENT_DATE,"YYYY-MM-DDTHH:mm:ss.sssZ","DD-MMM-YYYY").toUpperCase();a==t.BLANK_DATE?e.DOCUMENT_DATE="":e.DOCUMENT_DATE=a;var s=_.formatStrDate(e.EXPIRY_DATE,"YYYY-MM-DDTHH:mm:ss.sssZ","DD-MMM-YYYY").toUpperCase();s==t.BLANK_DATE?(e.expiry="",e.EXPIRY_DATE="",e.ORIGINAL_EXPIRY_DATE=""):(e.expiry=_.formatStrDate(e.EXPIRY_DATE,"YYYY-MM-DDTHH:mm:ss.sssZ","DD/MM/YYYY").toUpperCase(),e.EXPIRY_DATE=_.formatStrDate(e.EXPIRY_DATE,"YYYY-MM-DDTHH:mm:ss.sssZ","YYYY-MM-DDTHH:mm:ss").toUpperCase(),e.ORIGINAL_EXPIRY_DATE=e.EXPIRY_DATE);var l=_.formatStrDate(e.ACTUAL_DELIVERY_DATE,"YYYY-MM-DDTHH:mm:ss.sssZ","DD-MMM-YYYY").toUpperCase();l==t.BLANK_DATE?(e.ACTUAL_DELIVERY_DATE="",e.ORIGINAL_ACTUAL_DELIVERY_DATE=""):(e.ACTUAL_DELIVERY_DATE=_.formatStrDate(e.ACTUAL_DELIVERY_DATE,"YYYY-MM-DDTHH:mm:ss.sssZ","YYYY-MM-DDTHH:mm:ss").toUpperCase(),e.ORIGINAL_ACTUAL_DELIVERY_DATE=e.ACTUAL_DELIVERY_DATE),e.LOT_NUMBER="-1"==e.LOT_NUMBER?"":e.LOT_NUMBER}catch(e){}e.id=e.DELIVERY_DETAIL_ID+":"+e.ORDER_HEADER_ID+":"+e.ORDER_LINE_ID+":"+e.DEPOSIT_LINE_ID,"DELIVERY NOTE"==e.DOCUMENT_TYPE?e.MAX_QTY=e.DELIVERY_QUANTITY:e.MAX_QTY=9999,n+=1,e.rowCount=n,"DELIVERY NOTE"==e.DOCUMENT_TYPE?e.actualQty=e.DELIVERY_QUANTITY:e.actualQty=e.RECEIVE_QUANTITY,e.SHIP_TO_ADDRESS_LINE_1="-1"==e.SHIP_TO_ADDRESS_LINE_1?"":e.SHIP_TO_ADDRESS_LINE_1,e.SHIP_TO_ADDRESS_LINE_2="-1"==e.SHIP_TO_ADDRESS_LINE_2?"":e.SHIP_TO_ADDRESS_LINE_2,e.SHIP_TO_ADDRESS_LINE_3="-1"==e.SHIP_TO_ADDRESS_LINE_3?"":e.SHIP_TO_ADDRESS_LINE_3,e.ORIGINAL_LOT_NUMBER=e.LOT_NUMBER,e.ORIGINAL_QUANTITY_SHIPPED=e.QUANTITY_SHIPPED,e.ORIGINAL_QUANTITY_RECEIVED=e.QUANTITY_RECEIVED,e.IN_WAREHOUSE="-1"==e.IN_WAREHOUSE?null:e.IN_WAREHOUSE,e.OUT_WAREHOUSE="-1"==e.OUT_WAREHOUSE?null:e.OUT_WAREHOUSE,e.ORIGINAL_IN_WAREHOUSE=e.IN_WAREHOUSE,e.ORIGINAL_OUT_WAREHOUSE=e.OUT_WAREHOUSE,e.isDeliveryNote="DELIVERY NOTE"==e.DOCUMENT_TYPE,e.isPickupNote="PICKUP NOTE"==e.DOCUMENT_TYPE,e.isLotReadOnly=!0,e.isExpReadOnly=!0,"PICKUP NOTE"==e.DOCUMENT_TYPE&&(e.isLotReadOnly="Y"!=e.LOT_ENABLE,e.isExpReadOnly="Y"!=e.EXPIRY_ENABLE),e.documentType="DELIVERY NOTE"==e.DOCUMENT_TYPE?"DELIVERY":"PICKUP","-1"!=e.PROCESS_FLAG&&e.PROCESS_FLAG?e.PROCESS_FLAG&&(e.PROCESS_FLAG=!0):e.PROCESS_FLAG=!1,e.ORIGINAL_PROCESS_FLAG=e.PROCESS_FLAG,"-1"!=e.LINDE_REMARK&&e.LINDE_REMARK||(e.LINDE_REMARK=null),e.ORIGINAL_LINDE_REMARK=e.LINDE_REMARK,r.push({id:e.id,DELIVERY_DETAIL_ID:e.DELIVERY_DETAIL_ID,ORDER_HEADER_ID:e.ORDER_HEADER_ID,ORDER_LINE_ID:e.ORDER_LINE_ID,DEPOSIT_LINE_ID:e.DEPOSIT_LINE_ID,DOCUMENT_TYPE:e.DOCUMENT_TYPE,SALES_ORDER_NO:e.SALES_ORDER_NO,PAYMENT_TERM:e.PAYMENT_TERM,CUSTOMER_NO:e.CUSTOMER_NO,CUSTOMER_NAME:e.CUSTOMER_NAME,SHIP_TO_ADDRESS_LINE_1:e.SHIP_TO_ADDRESS_LINE_1,PRODUCT_DESCRIPTION:e.PRODUCT_DESCRIPTION,LOT_NUMBER:o.observable(e.LOT_NUMBER),UOM:e.UOM,EXPIRY_DATE:o.observable(e.EXPIRY_DATE),expiry:e.expiry,ACTUAL_DELIVERY_DATE:o.observable(e.ACTUAL_DELIVERY_DATE),QUANTITY_SHIPPED:o.observable(e.QUANTITY_SHIPPED),QUANTITY_RECEIVED:o.observable(e.QUANTITY_RECEIVED),ORIGINAL_LOT_NUMBER:e.ORIGINAL_LOT_NUMBER,ORIGINAL_EXPIRY_DATE:e.ORIGINAL_EXPIRY_DATE,ORIGINAL_ACTUAL_DELIVERY_DATE:e.ORIGINAL_ACTUAL_DELIVERY_DATE,ORIGINAL_QUANTITY_SHIPPED:e.ORIGINAL_QUANTITY_SHIPPED,ORIGINAL_QUANTITY_RECEIVED:e.ORIGINAL_QUANTITY_RECEIVED,ORIGINAL_IN_WAREHOUSE:e.ORIGINAL_IN_WAREHOUSE,ORIGINAL_OUT_WAREHOUSE:e.ORIGINAL_OUT_WAREHOUSE,actualQty:e.actualQty,OUT_WAREHOUSE:o.observable(e.OUT_WAREHOUSE),rowCount:e.rowCount,isDeliveryNote:e.isDeliveryNote,isPickupNote:e.isPickupNote,isLotReadOnly:e.isLotReadOnly,isExpReadOnly:e.isExpReadOnly,documentType:e.documentType,PROCESS_FLAG:e.PROCESS_FLAG?o.observable(!0):o.observable(!1),ORIGINAL_PROCESS_FLAG:!!e.ORIGINAL_PROCESS_FLAG,LINDE_REMARK:o.observable(e.LINDE_REMARK),ORIGINAL_LINDE_REMARK:e.ORIGINAL_LINDE_REMARK,MAX_QTY:e.MAX_QTY,DOCUMENT_NO:e.DOCUMENT_NO,DOCUMENT_DATE:e.DOCUMENT_DATE,SHIP_TO_ADDRESS_LINE_2:e.SHIP_TO_ADDRESS_LINE_2,SHIP_TO_ADDRESS_LINE_3:e.SHIP_TO_ADDRESS_LINE_3,CURRENCY:e.CURRENCY,LINE_NO:e.LINE_NO,PRODUCT_NO:e.PRODUCT_NO,DELIVERY_QUANTITY:e.DELIVERY_QUANTITY,RECEIVE_QUANTITY:e.RECEIVE_QUANTITY,UNIT_PRICE:e.UNIT_PRICE,TOTAL_AMOUNT:e.TOTAL_AMOUNT,IN_WAREHOUSE:o.observable(e.IN_WAREHOUSE),DEPOSIT_PRODUCT_NO:e.DEPOSIT_PRODUCT_NO,DEPOSIT_UNIT_PRICE:e.DEPOSIT_UNIT_PRICE,DEPOSIT_TOTAL_AMOUNT:e.DEPOSIT_TOTAL_AMOUNT})}),O.allLoaded(r)}}function T(){s.showBusy();var e=O.fromDate(),a=O.toDate(),r=O.documentNo(),t=O.orderNo(),_=O.customerNo(),l=O.customerName();l&&(l=l.toString().toUpperCase());var E=O.shipAddress();E&&(E=E.toString().toUpperCase()),e||(e=null),a||(a=null),r||(r=null),console.log("fromDate="+e),console.log("toDate="+a),console.log("documentNo="+r),console.log("orderNo="+t),console.log("customerNo="+_),console.log("customerName="+l),console.log("shipAddress="+E);var i=D(e,a,r,t,_,l,E);console.log("reviewLoading payload ="+o.toJS(i)),O.allLoaded.removeAll();var u=function(e,o){try{I(e,o.status)}catch(e){console.error(e)}finally{s.hideBusy(),console.log("cbSuccessFn called")}},T=function(e,o){console.log("cbFailFn failed"),I(e,o.status),s.hideBusy()};n.getReviewLoadingListMessage(i).then(u,T)}function D(e,o,a,r,s,t,_){return n.getEnquiryPayload(e,o,a,r,s,t,_)}function R(){var o=e.Translations.getTranslatedString;O.lng_title=o("ssa.reviewLoading.title"),O.lng_fromDate=o("ssa.reviewLoading.fromDate"),O.lng_toDate=o("ssa.reviewLoading.toDate"),O.lng_documentNo=o("ssa.reviewLoading.documentNo"),O.lng_documentType=o("ssa.reviewLoading.documentType"),O.lng_documentDate=o("ssa.reviewLoading.documentDate"),O.lng_orderNo=o("ssa.reviewLoading.orderNo"),O.lng_customerNo=o("ssa.reviewLoading.customerNo"),O.lng_customerName=o("ssa.reviewLoading.customerName"),O.lng_paymentTerm=o("ssa.reviewLoading.paymentTerm"),O.lng_shipAddress1=o("ssa.reviewLoading.shipAddress1"),O.lng_shipAddress2=o("ssa.reviewLoading.shipAddress2"),O.lng_shipAddress3=o("ssa.reviewLoading.shipAddress3"),O.lng_currency=o("ssa.reviewLoading.currency"),O.lng_lineNo=o("ssa.reviewLoading.lineNo"),O.lng_product=o("ssa.reviewLoading.product"),O.lng_productDescription=o("ssa.reviewLoading.productDescription"),O.lng_uom=o("ssa.reviewLoading.uom"),O.lng_lot=o("ssa.reviewLoading.lot"),O.lng_expiryDate=o("ssa.reviewLoading.expiryDate"),O.lng_actualDeliveryDate=o("ssa.reviewLoading.actualDeliveryDate"),O.lng_quantityShipped=o("ssa.reviewLoading.quantityShipped"),O.lng_quantityReceived=o("ssa.reviewLoading.quantityReceived"),O.lng_deliveryQuantity=o("ssa.reviewLoading.deliveryQuantity"),O.lng_receiveQuantity=o("ssa.reviewLoading.receiveQuantity"),O.lng_actualQuantity=o("ssa.reviewLoading.actualQuantity"),O.lng_quantity=o("ssa.reviewLoading.quantity"),O.lng_unitPrice=o("ssa.reviewLoading.unitPrice"),O.lng_totalAmount=o("ssa.reviewLoading.totalAmount"),O.lng_depositItem=o("ssa.reviewLoading.depositItem"),O.lng_searchPlaceHolder=o("ssa.header.search"),O.lng_primaryText=o("ssa.pullToRefreshUtils.primaryText"),O.lng_secondaryText=o("ssa.pullToRefreshUtils.secondaryText"),O.lng_search=o("ssa.reviewLoading.search"),O.lng_reset=o("ssa.reviewLoading.reset"),O.lng_export=o("ssa.reviewLoading.export"),O.lng_error_00031=o("ssa.msg.error.ERROR_00031"),O.lng_error_00032=o("ssa.msg.error.ERROR_00032"),O.lng_error_00040=o("ssa.msg.error.ERROR_00040"),O.lng_maintenance=o("ssa.msg.info.maintenance"),O.lng_confirmSave=o("ssa.reviewLoading.confirmSave"),O.lng_recordSaved=o("ssa.msg.info.recordSaved"),O.lng_exportSuccess=o("ssa.msg.info.exportSuccess"),O.lng_documentInfo=o("ssa.reviewLoading.documentInfo"),O.lng_customerInfo=o("ssa.reviewLoading.customerInfo"),O.lng_orderItemInfo=o("ssa.reviewLoading.orderItemInfo"),O.lng_depositItemInfo=o("ssa.reviewLoading.depositItemInfo"),O.lng_proceed=o("ssa.reviewLoading.proceed"),O.lng_inWarehouse=o("ssa.reviewLoading.inWarehouse"),O.lng_outWarehouse=o("ssa.reviewLoading.outWarehouse"),O.lng_sumOriginalDelivery=o("ssa.reviewLoading.sumOriginalDelivery"),O.lng_sumOutWarehouse=o("ssa.reviewLoading.sumOutWarehouse"),O.lng_sumPickUp=o("ssa.reviewLoading.sumPickUp"),O.lng_sumDelivery=o("ssa.reviewLoading.sumDelivery"),O.lng_lindeRemark=o("ssa.reviewLoading.lindeRemark")}var O=this;console.log("ReviewLoadingViewModel");var c="OutputUpdateReadDNRMAIntf";O.router=r.router,O.fromDate=o.observable(),O.toDate=o.observable(),O.documentNo=o.observable(),O.orderNo=o.observable(),O.customerNo=o.observable(),O.customerName=o.observable(),O.shipAddress=o.observable(),O.isFocused=o.observable(!1),O.allLoaded=o.observableArray(),O.scrollPos=o.observable(0),O.searchText=o.observable(""),O.selectedAll=o.observableArray([]),O.CUSTOMER_NO=o.observable(),O.CUSTOMER_NAME=o.observable(),O.SHIP_TO_ADDRESS_LINE_1=o.observable(),O.SALES_ORDER_NO=o.observable(),O.DOCUMENT_NO=o.observable(),O.DOCUMENT_DATE=o.observable(),O.SHIP_TO_ADDRESS_LINE_2=o.observable(),O.SHIP_TO_ADDRESS_LINE_3=o.observable(),O.CURRENCY=o.observable(),O.LINE_NO=o.observable(),O.PRODUCT_NO=o.observable(),O.DELIVERY_QUANTITY=o.observable(),O.RECEIVE_QUANTITY=o.observable(),O.UNIT_PRICE=o.observable(),O.TOTAL_AMOUNT=o.observable(),O.DEPOSIT_PRODUCT_NO=o.observable(),O.DEPOSIT_UNIT_PRICE=o.observable(),O.DEPOSIT_TOTAL_AMOUNT=o.observable(),O.searchText.extend({rateLimit:{timeout:500,method:"notifyWhenChangesStop"}}),O.dataFormat=o.observable("dd/MM/yyyy");var d=e.Validation.converterFactory("datetime");O.dateConverter=d.createConverter({pattern:O.dataFormat()}),O.isLindeAdmin=o.computed(function(){var e=r.moduleConfig.params.rootContext.userProfile;return e.salesRole==t.SR_AMIN_LINDE}),O.sumOriginalDelivery=o.computed(function(){var e=0;return O.allLoaded().forEach(function(a){e+=new Number(o.utils.unwrapObservable(a.DELIVERY_QUANTITY))}),e}),O.sumOutWarehouse=o.computed(function(){var e=0;return O.allLoaded().forEach(function(a){e+=new Number(o.utils.unwrapObservable(a.OUT_WAREHOUSE))}),e}),O.sumPickup=o.computed(function(){var e=0;return O.allLoaded().forEach(function(a){e+=new Number(o.utils.unwrapObservable(a.QUANTITY_RECEIVED))}),e}),O.sumDelivery=o.computed(function(){var e=0;return O.allLoaded().forEach(function(a){e+=new Number(o.utils.unwrapObservable(a.QUANTITY_SHIPPED))}),e}),O.fromDate.subscribe(function(e){var o=moment(e,"YYYY-MM-DDTHH:mm:ss").add(1,"M").format("YYYY-MM-DDTHH:mm:ss");O.toDate(o)}),O.handleActivated=function(o){var a=o.valueAccessor().params.ojRouter.parentRouter;console.log("reviewLoading.js parentRouter="+a.currentState().value),O.scrollPos(0);var r=a.getChildRouter("reviewLoading");return r||(r=a.createChildRouter("reviewLoading")),O.router=r.configure(function(o){if(o){var a=new e.RouterState(o,{value:o,enter:function(){console.log("reviewLoading.js stateId="+o)}});return a}}),E(),e.Router.sync()},O.handleBindingsApplied=function(e){var o=a("#globalBody").find(".oj-hybrid-applayout-content"),r="oj-hybrid-applayout-scrollable";o.hasClass(r)&&(a("#searchCanvas").on("ojbeforeopen",function(){o.removeClass(r)}),a("#searchCanvas").on("ojbeforeclose",function(){o.addClass(r)})),a("#searchCanvas").on("ojclose",function(){O.clearSearch()})},O.maxDate=o.computed(function(){var e=moment(O.fromDate(),"YYYY-MM-DD").add(1,"M").format("YYYY-MM-DDTHH:mm:ss");return e<O.toDate()?O.toDate():e}),O.openDetail=function(e,r,s){e&&(console.log("data = "+o.toJSON(e)),O.DOCUMENT_NO(e.DOCUMENT_NO),O.DOCUMENT_DATE(e.DOCUMENT_DATE),O.CUSTOMER_NO(e.CUSTOMER_NO),O.CUSTOMER_NAME(e.CUSTOMER_NAME),O.SHIP_TO_ADDRESS_LINE_1(e.SHIP_TO_ADDRESS_LINE_1),O.SHIP_TO_ADDRESS_LINE_2(e.SHIP_TO_ADDRESS_LINE_2),O.SHIP_TO_ADDRESS_LINE_3(e.SHIP_TO_ADDRESS_LINE_3),O.SALES_ORDER_NO(e.SALES_ORDER_NO),O.CURRENCY(e.CURRENCY),O.LINE_NO(e.LINE_NO),O.PRODUCT_NO(e.PRODUCT_NO),O.DELIVERY_QUANTITY(e.DELIVERY_QUANTITY),O.RECEIVE_QUANTITY(e.RECEIVE_QUANTITY),O.UNIT_PRICE(e.UNIT_PRICE),O.TOTAL_AMOUNT(e.TOTAL_AMOUNT),O.DEPOSIT_PRODUCT_NO(e.DEPOSIT_PRODUCT_NO),O.DEPOSIT_UNIT_PRICE(e.DEPOSIT_UNIT_PRICE),O.DEPOSIT_TOTAL_AMOUNT(e.DEPOSIT_TOTAL_AMOUNT),a("#scrollingDialog").ojDialog("open"))},O.goBack=function(){r.router.go("springboard")},O.dispose=function(e){O.router.dispose()},O.refresh=function(){s.showBusy(),T()},O.search=function(){console.log("search");var e=l.isMaintenance();return e?void s.showMessageBox(O.lng_maintenance):void T()},O.reset=function(){console.log("reset"),u()},O.report=function(){s.showBusy(),console.log("export report");var e=O.fromDate(),a=O.toDate();e||(e=null),a||(a=null);var r=n.getReportPayload(e,a);console.log("payload = "+o.toJS(r));var t=function(e,o){try{if(null!==e&&200==o.status){var a=e[c],r=a.P_RETURN_STATUS;return"S"!=r?void s.showMessageBox(O.lng_error_00040):void s.showMessageBox(O.lng_exportSuccess)}return void s.showMessageBox(O.lng_error_00040)}catch(e){console.error(e)}finally{s.hideBusy(),console.log("cbSuccessFn called")}},_=function(e,o){console.log("cbFailFn failed"),s.showMessageBox(O.lng_error_00040),s.hideBusy()};n.updateLoadingListMessage(r).then(t,_)},O.save=function(){if(console.log("save"),confirm(O.lng_confirmSave)){var e=[];if(o.utils.arrayMap(O.allLoaded(),function(a){var r=o.utils.unwrapObservable(a.PROCESS_FLAG),s=o.utils.unwrapObservable(a.ORIGINAL_PROCESS_FLAG),n=a.ORIGINAL_EXPIRY_DATE,t=o.utils.unwrapObservable(a.EXPIRY_DATE),_=a.ORIGINAL_ACTUAL_DELIVERY_DATE,l=o.utils.unwrapObservable(a.ACTUAL_DELIVERY_DATE);l&&(l=new moment(l).format("YYYY-MM-DD")),_&&(_=new moment(_).format("YYYY-MM-DD")),t&&(t=new moment(t).format("YYYY-MM-DD")),n&&(n=new moment(n).format("YYYY-MM-DD")),a.ORIGINAL_QUANTITY_RECEIVED==o.utils.unwrapObservable(a.QUANTITY_RECEIVED)&&a.ORIGINAL_QUANTITY_SHIPPED==o.utils.unwrapObservable(a.QUANTITY_SHIPPED)&&a.ORIGINAL_LOT_NUMBER==o.utils.unwrapObservable(a.LOT_NUMBER)&&n==t&&_==l&&s==r&&a.ORIGINAL_IN_WAREHOUSE==o.utils.unwrapObservable(a.IN_WAREHOUSE)&&a.ORIGINAL_OUT_WAREHOUSE==o.utils.unwrapObservable(a.OUT_WAREHOUSE)&&a.ORIGINAL_LINDE_REMARK==o.utils.unwrapObservable(a.LINDE_REMARK)||e.push({DELIVERY_DETAIL_ID:a.DELIVERY_DETAIL_ID==-1?null:a.DELIVERY_DETAIL_ID,ORDER_HEADER_ID:a.ORDER_HEADER_ID==-1?null:a.ORDER_HEADER_ID,ORDER_LINE_ID:a.ORDER_LINE_ID==-1?null:a.ORDER_LINE_ID,LOT_NUMBER:o.utils.unwrapObservable(a.LOT_NUMBER)?new String(o.utils.unwrapObservable(a.LOT_NUMBER)).toUpperCase():o.utils.unwrapObservable(a.LOT_NUMBER),EXPIRY_DATE:o.utils.unwrapObservable(a.EXPIRY_DATE),ACTUAL_DELIVERY_DATE:o.utils.unwrapObservable(a.ACTUAL_DELIVERY_DATE),QUANTITY_SHIPPED:o.utils.unwrapObservable(a.QUANTITY_SHIPPED),QUANTITY_RECEIVED:o.utils.unwrapObservable(a.QUANTITY_RECEIVED),IN_WAREHOUSE:o.utils.unwrapObservable(a.IN_WAREHOUSE)?o.utils.unwrapObservable(a.IN_WAREHOUSE):null,OUT_WAREHOUSE:o.utils.unwrapObservable(a.OUT_WAREHOUSE)?o.utils.unwrapObservable(a.OUT_WAREHOUSE):null,LINDE_REMARK:o.utils.unwrapObservable(a.LINDE_REMARK)?o.utils.unwrapObservable(a.LINDE_REMARK):null,PROCESS_FLAG:r?"S":null})}),e.length>0){s.showBusy();var a=n.getUpdatePayload(e);console.log("update payload="+a);var r=function(e,a){try{if(null!==e&&200==a.status){var r=e[c],n=r.P_RETURN_STATUS;return"S"!=n?void s.showMessageBox(O.lng_error_00032):(o.utils.arrayMap(O.allLoaded(),function(e){console.log("after update = "+o.utils.unwrapObservable(e.PROCESS_FLAG)),o.utils.unwrapObservable(e.PROCESS_FLAG)?e.ORIGINAL_PROCESS_FLAG=!0:e.ORIGINAL_PROCESS_FLAG=!1}),O.allLoaded.valueHasMutated(),void s.showMessageBox(O.lng_recordSaved))}return void s.showMessageBox(O.lng_error_00032)}catch(e){console.error(e)}finally{s.hideBusy(),console.log("cbSuccessFn called")}},t=function(e,o){console.log("cbFailFn failed"),s.showMessageBox(O.lng_error_00032),s.hideBusy()};n.updateLoadingListMessage(a).then(r,t)}}},O.process_flag_hdr_func=function(e){e.columnHeaderSortableIconRenderer(null,function(e){console.log("process header column");var o=a(document.createElement("div"));o.attr("style","display: inline-block; padding-right: 0.5em;"),o.text(O.lng_proceed);var r=a(document.createElement("input"));r.attr("style","vertical-align: middle;"),r.attr("type","checkbox"),r.attr("id","selectAllDocuments"),e.append(o),e.append(r)})},O.optionChange=function(e,o){"selection"===o.option&&o.value[0]&&console.log("reviewLoading.js ui.value="+o.value)},O.onClearSearchText=function(){O.clearSearch()},O.clearSearch=function(){var e=a("#searchProduct");e.ojInputText("option","value",""),e.ojInputText("reset"),O.searchText("")},O.toggleSearchCanvas=function(){console.log("toggleSearchCanvas triggered"),e.OffcanvasUtils.toggle(i)},O.onSearchTextChange=function(e,a){if("rawValue"===a.option){console.log("onSearchTextChange.data.value="+a.value),O.searchText(a.value);var r=O.searchText().toLowerCase(),s=new Array;0!==O.allLoaded().length&&(0===O.searchText().length?s=O.allLoaded():o.utils.arrayFilter(O.allLoaded(),function(e){e.DELIVERY_NUMBER.toLowerCase().indexOf(r)>=0&&s.push(e)}))}},O.getRowTemplate=function(e,o){return"editRowTemplate"},O.datasource=o.computed(function(){return new e.ArrayTableDataSource(O.allLoaded(),{idAttribute:"id"})}),a(document).ready(function(){document.getElementById("text-orderNo").focus(),a("#selectAllDocuments").click(function(){var e=this.checked;console.log("action="+e),a("input:checkbox").not(this).prop("checked",this.checked),O.allLoaded().forEach(function(a){console.log(">>>>>>>>>>>>>>"+o.utils.unwrapObservable(a.PROCESS_FLAG)),e?a.PROCESS_FLAG=o.observable(!0):a.PROCESS_FLAG=o.observable(!1),console.log(o.utils.unwrapObservable(a.PROCESS_FLAG))}),O.allLoaded.valueHasMutated()})})}var i;return i={selector:"#searchCanvas",edge:"top",displayMode:"push",size:"63px",modality:"modeless",autoDismiss:"none"},o.bindingHandlers.executeOnEnter={init:function(e,o,r,s){var n=o();a(e).keypress(function(e){var o=e.which?e.which:e.keyCode;return 13!==o||(n.call(s),!1)})}},o.bindingHandlers.datePicker={init:function(e,a,r,s){o.utils.registerEventHandler(e,"change",function(){var o=a();o(new Date(e.value))})},update:function(e,o,a,r){var s=o(),n=new moment(s()).format("YYYY-MM-DD");e.value=n}},new E});