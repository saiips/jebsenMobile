define(["knockout","jquery","util/appui","util/devmode","appController","util/commonhelper","pages/common/constant"],function(e,t,i,s,n,o,r){function a(){function n(e){return this.getVisitationListMessage(e,!1)}function n(n,a){var u=t.Deferred(),c=e.utils.parseJson(n),l=c.InputGetVisitation.P_ORG_ID,f=c.InputGetVisitation.P_SALESREP_ID,I=r.VISITATION_LIST_KEY+":"+l+":"+f;if(s.isEnabled()&&s.isOffline())return t.getJSON("js/app/pages/visitation/visitationListMock.json",function(e){setTimeout(function(){u.resolve(e,{status:200})},500)}),t.when(u);var p=i.getLocalStorage(I);return p&&!a?(console.log("[Local Storage] Visitation List - "+I),u.resolve(p,{status:200})):(console.log("[Amplify Request] Visitation List - "+I),amplify.request({resourceId:r.VISITATION_LIST_KEY,success:u.resolve,error:u.reject,data:n}),i.setLocalStorage(I+":"+r.VISITATIONS_SYNC_DATETIME,o.getClientCurrentDate(r.DATETIME_FORMAT).toUpperCase()),t.when(u).done(function(e,t,s){i.setLocalStorage(I,e)})),t.when(u)}function a(e){var i=t.Deferred();return s.isEnabled()&&s.isOffline()?(t.getJSON("js/app/pages/visitation/updateVisitationMock.json",function(e){setTimeout(function(){i.resolve(e,{status:200})},500)}),t.when(i)):(console.log("[Amplify Request] Update Visitation - "+r.UPDATE_VISITATION_KEY),amplify.request({resourceId:r.UPDATE_VISITATION_KEY,success:i.resolve,error:i.reject,data:e}),t.when(i))}function u(e){var i=t.Deferred();return s.isEnabled()&&s.isOffline()?(t.getJSON("js/app/pages/visitation/newVisitationMock.json",function(e){setTimeout(function(){i.resolve(e,{status:200})},500)}),t.when(i)):(console.log("[Amplify Request] Create Visitation - "+r.CREATE_VISITATION_KEY),amplify.request({resourceId:r.CREATE_VISITATION_KEY,success:i.resolve,error:i.reject,data:e}),t.when(i))}this.getVisitationListMessage=function(e){return n(e)},this.refreshVisitationListMessage=function(e){return n(e,!0)},this.updateVisitationMessage=function(e){return a(e)},this.createVisitationMessage=function(e){return u(e)}}return new a});