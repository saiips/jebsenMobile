define(["knockout","jquery","appController","util/commonhelper","pages/common/constant"],function(e,r,t,s,a){function _(){var _=this;_.cart=e.observableArray([]),_.order=e.observableArray([]),_.quotation=e.observableArray([]),_.savedOrder=[];var i=function(r){this.cust_name=e.observable(r.CUSTOMER_NAME),this.outlet_name=e.observable(r.OUTLET_NAME),this.order_no=e.observable(r.ORDER_NUMBER),this.purchase_order=e.observable("-1"===r.CUST_PO_NUMBER?"":r.CUST_PO_NUMBER),s.isDateFormat(r.ORDERED_DATE,"YYYY/MM/DD")?this.order_date=e.observable(r.ORDERED_DATE):s.isValid(r.ORDERED_DATE)?this.order_date=e.observable(s.formatStrDateToYYYYMMDD(r.ORDERED_DATE)):this.order_date=e.observable(s.getClientCurrentDate()),this.real_customer=e.observable("-1"===r.REAL_CUSTOMER?"":r.REAL_CUSTOMER),this.remarks=e.observable("-1"===r.ORDER_REMARKS?"":r.ORDER_REMARKS),this.delivery_cost=e.observable(r.FREIGHT_CHARGE),this.ship_to_district=e.observable(r.SHIP_TO_DISTRICT),this.shipping_address=e.observable(r.SHIP_TO_ADDRESS),this.billing_address=e.observable(r.BILL_TO_ADDRESS),this.status=e.observable(r.HEADER_FLOW_STATUS_CODE),this.sold_to_org_id=e.observable(r.SOLD_TO_ORG_ID),this.ship_to_org_id=e.observable(r.SHIP_TO_ORG_ID),this.invoice_to_org_id=e.observable(r.INVOICE_TO_ORG_ID),this.price_list_id=e.observable(r.PRICE_LIST_ID),this.pricing_date=e.observable(r.PRICING_DATE),this.sold_from_org_id=e.observable(r.SOLD_FROM_ORG_ID),this.ship_from_org_id=e.observable(r.SHIP_FROM_ORG_ID),this.sales_rep_id=e.observable(r.SALES_REP_ID),this.transactional_curr_code=e.observable(r.TRANSACTIONAL_CURR_CODE),this.payment_term_id=e.observable(r.PAYMENT_TERM_ID),this.oe_header_id=e.observable(r.OE_HEADER_ID),this.order_type_id=e.observable(r.ORDER_TYPE_ID),this.order_type=e.observable(r.ORDER_TYPE),this.order_tot_amt=e.observable(r.ORDER_TOT_AMT),this.walk_in_cust=e.observable(r.WALK_IN_CUST),this.override_sub_inventory=e.observable("-1"===r.OVERRIDE_SUB_INVENTORY?"":r.OVERRIDE_SUB_INVENTORY),this.override_shipment_method=e.observable("-1"===r.OVERRIDE_SHIPMENT_METHOD?"":r.OVERRIDE_SHIPMENT_METHOD),this.override_shipment_date=e.observable(r.OVERRIDE_SHIPMENT_DATE),this.custAccountId=e.observable(r.CUST_ACCOUNT_ID),this.accountNumber=e.observable(r.ACCOUNT_NUMBER),this.override_billTo=e.observable(r.OVERRIDE_BILL_TO),this.override_salesPerson=e.observable(r.OVERRIDE_SALES_PERSON),this.payment_method=e.observable("-1"===r.PAYMENT_METHOD?null:r.PAYMENT_METHOD)};e.dirtyFlag=function(r,t){var s=function(){},a=e.observable(e.toJSON(r)),_=e.observable(t);return s.isDirty=e.computed(function(){return _()||a()!==e.toJSON(r)}),s.reset=function(){a(e.toJSON(r)),_(!1)},s};var o=function(r,t){this.id=e.observable(r.id),this.MODIFIER_NUMBER="-1"==r.MODIFIER_NUMBER?e.observable(null):e.observable(r.MODIFIER_NUMBER),this.FROM_STAGING="Y"==r.FROM_STAGING?e.observable(!0):e.observable(!1),this.MODIFIER_TYPE=e.observable(r.MODIFIER_TYPE),this.MODIFIER_ITEM_ID=e.observable(r.MODIFIER_ITEM_ID),this.MODIFIER_VALUE_FROM="-1"==r.MODIFIER_VALUE_FROM?e.observable(null):e.observable(r.MODIFIER_VALUE_FROM),this.GET_ITEM_ID="-1"==r.GET_ITEM_ID?e.observable(null):e.observable(new String(r.GET_ITEM_ID).toString()),this.GET_ITEM_NUMBER="-1"==r.GET_ITEM_NUMBER?e.observable(null):e.observable(r.GET_ITEM_NUMBER),this.GET_QUANTITY="-1"==r.GET_QUANTITY?e.observable(null):e.observable(r.GET_QUANTITY),this.GET_PRICE="-1"==r.GET_PRICE?e.observable(null):e.observable(r.GET_PRICE),this.GET_PROMOTION_NATURE="-1"==r.GET_PROMOTION_NATURE?e.observable(null):e.observable(r.GET_PROMOTION_NATURE),this.GET_PERCENT="-1"==r.GET_PERCENT?e.observable(null):e.observable(r.GET_PERCENT),this.MODIFIER_START_DATE=e.observable(r.MODIFIER_START_DATE),this.MODIFIER_END_DATE=e.observable(r.MODIFIER_END_DATE),this.MODIFIER_SHIP_TO="Y"==r.MODIFIER_SHIP_TO?e.observable(!0):e.observable(!1),this.dirtyFlag=new e.dirtyFlag(r,t),this.SHOW_LINK_BTN="Y"==r.SHOW_LINK_BTN?e.observable(!0):e.observable(!1),this.SHOW_REMOVE_BTN="Y"==r.SHOW_REMOVE_BTN?e.observable(!0):e.observable(!1),this.ENABLE_SHIP_TO="Y"==r.ENABLE_SHIP_TO?e.observable(!0):e.observable(!1);var a=r.MODIFIER_START_DATE,_=r.MODIFIER_END_DATE;try{a=s.formatStrDate(r.MODIFIER_START_DATE,"YYYY-MM-DDTHH:mm:ss.sssZ","YYYY-MM-DD"),_=s.formatStrDate(r.MODIFIER_END_DATE,"YYYY-MM-DDTHH:mm:ss.sssZ","YYYY-MM-DD")}catch(e){}this.ORIGINAL_MODIFIER_VALUE_FROM="-1"==r.MODIFIER_VALUE_FROM?null:r.MODIFIER_VALUE_FROM,this.ORIGINAL_GET_ITEM_ID="-1"==r.GET_ITEM_ID?null:new String(r.GET_ITEM_ID).toString(),this.ORIGINAL_GET_QUANTITY="-1"==r.GET_QUANTITY?null:r.GET_QUANTITY,this.ORIGINAL_GET_PRICE="-1"==r.GET_PRICE?null:r.GET_PRICE,this.ORIGINAL_GET_PROMOTION_NATURE="-1"==r.GET_PROMOTION_NATURE?null:r.GET_PROMOTION_NATURE,this.ORIGINAL_GET_PERCENT="-1"==r.GET_PERCENT?null:r.GET_PERCENT,this.ORIGINAL_MODIFIER_START_DATE=a,this.ORIGINAL_MODIFIER_END_DATE=_,this.ORIGINAL_MODIFIER_SHIP_TO="Y"==r.MODIFIER_SHIP_TO},b=function(r){this.cust_name=e.observable(r.CUSTOMER_NAME),this.quotation_no=e.observable(r.QUOTATION_NUMBER),s.isValid(r.QUOTATION_DATE)?this.quotation_date=e.observable(s.formatStrDateToYYYYMMDD(r.QUOTATION_DATE)):this.quotation_date=e.observable(s.getClientCurrentDate()),this.real_customer=e.observable("-1"===r.REAL_CUSTOMER?"":r.REAL_CUSTOMER),this.remarks=e.observable("-1"===r.REMARKS?"":r.REMARKS),this.shipping_address=e.observable(r.SHIP_TO_ADDRESS),this.billing_address=e.observable(r.BILL_TO_ADDRESS),this.status=e.observable(r.HEADER_FLOW_STATUS_CODE),this.sold_to_org_id=e.observable(r.SOLD_TO_ORG_ID),this.ship_to_org_id=e.observable(r.SHIP_TO_ORG_ID),this.invoice_to_org_id=e.observable(r.INVOICE_TO_ORG_ID),this.price_list_id=e.observable(r.PRICE_LIST_ID),this.sold_from_org_id=e.observable(r.SOLD_FROM_ORG_ID),this.ship_from_org_id=e.observable(r.SHIP_FROM_ORG_ID),this.sales_rep_id=e.observable(r.SALES_REP_ID),this.transactional_curr_code=e.observable(r.TRANSACTIONAL_CURR_CODE),this.payment_term_id=e.observable(r.PAYMENT_TERM_ID),this.oe_header_id=e.observable(r.OE_HEADER_ID),this.order_type_id=e.observable(r.ORDER_TYPE_ID),this.order_type=e.observable(r.ORDER_TYPE),this.quotation_tot_qty=e.observable(r.QUOTATION_TOT_QTY),this.attention=e.observable("-1"===r.ATTENTION?"":r.ATTENTION),this.salesTerm=e.observable("-1"===r.SALES_TERM?"":r.SALES_TERM)},n=function(r){this.id=e.observable(r.INVENTORY_ITEM_ID),this.prod_desc=e.observable(r.PRODUCT_DESCRIPTION),this.prod_code=e.observable(r.PRODUCT),this.lot=e.observable("-1"===r.LOT_NUMBER||"-2"===r.LOT_NUMBER?"":r.LOT_NUMBER),this.sku=e.observable(r.ORDER_QUANTITY_UOM),this.price=e.observable(r.UNIT_SELLING_PRICE),this.shipping_district=e.observable(""),this.delivery_status=e.observable(r.FLOW_STATUS_CODE),this.prod_brand=e.observable(r.PRODUCT_BRAND),this.principal=e.observable(r.PRINCIPAL),this.currency_code=e.observable(r.CURRENCY_CODE),this.draft_beer_flag=e.observable(r.DRAFT_BEER_FLAG),this.isEditable=e.computed(function(){var e=(t.moduleConfig.params.rootContext.userProfile.orgUnitId,t.moduleConfig.params.rootContext.userProfile);return e.salesRole!=a.SR_SALE_VAN&&"Y"!==this.draft_beer_flag}),this.remark=e.observable("-1"===r.REMARK?"":r.REMARK),this.isFetchModifier=e.observable(!0),this.promotionItem=e.observableArray(),this.specialDiscount=e.observableArray(),this.specialAmount=e.observableArray()},l=function(r,t,s){this.id=e.observable(r),this.shipmentDate=e.observable(t),this.quantity=e.observable(s)},u=function(r,t,_,i,o,b,n,l,u){var E=this;E.product=e.observable(r),E.quantity=e.observable(t||0),E.id=e.observable(E.product().id),E.showAddCartBtn=e.observable(_),s.isValid(i)&&(E.shipment=e.observable(i)),E.original=e.observable(o),E.lotArray=e.observableArray(b),E.shipmentMethod=e.observable(l),E.shipmentMethodDisplay=e.observable("-1"==u||"undefined"==typeof u?"":u),E.subInventory=e.observable(n),E.isDisabledShipmentMethod=e.computed(function(){return a.MS_WAREHSE!=e.utils.unwrapObservable(E.subInventory())&&(a.JL_WAREHSE!=e.utils.unwrapObservable(E.subInventory())&&(a.PW_WAREHSE==e.utils.unwrapObservable(E.subInventory())||(E.shipmentMethod("-1"),!0)))}),E.isOriginal=e.computed(function(){return"Y"==E.original()}),E.cost=e.computed(function(){var r=e.utils.unwrapObservable(E.product().price),t=e.utils.unwrapObservable(E.quantity()),s=r*t;return s})};this.createModifier=function(e,r){return new o(e,r)},this.createQuotation=function(e){return new b(e)},this.createOrder=function(e){return new i(e)},this.setQuotation=function(e){_.quotation=e},this.getQuotation=function(){return _.quotation},this.setOrder=function(e){_.order=e},this.getOrder=function(){return _.order},this.setSavedOrder=function(e){_.savedOrder=e},this.getSavedOrder=function(){return _.savedOrder},this.createProduct=function(e){return new n(e)},this.createProductWithCart=function(t,s){var a=new n(t);return r(s()).each(function(r,t){e.toJSON(t.product().id)===e.toJSON(a.id)&&(a.quantity=e.toJSON(t.product().quantity))}),a},this.createCartFromStore=function(r,t){var s=e.utils.arrayFirst(t,function(t){return e.utils.unwrapObservable(t.product().id)==r.id});return null!=s?s.showAddCartBtn=e.observable(!1):"undefined"!=typeof s&&null!==s||(s=this.createCartItem(r,0,!0,"")),s},this.createCartItem=function(e,r,t){var s=new n(e);return new u(s,r,t,"")},this.createCartItem=function(e,r,t,s){var a=new n(e);return new u(a,r,t,s,"Y")},this.createCartItem=function(e,r,t,s,a){var _=new n(e),i=new Array;return new u(_,r,t,s,a,i)},this.createCartItem=function(e,r,t,s,a,_){var i=new n(e);return new u(i,r,t,s,a,_)},this.createCartItem=function(e,r,t,s,a,_,i,o){var b=new n(e);return new u(b,r,t,s,a,_,i,o,"")},this.createCartItem=function(e,r,t,s,a,_,i,o,b){var l=new n(e);return new u(l,r,t,s,a,_,i,o,b)},this.cloneOrder=function(e){var r=this.payload4Order(e),e=new i(r);return e},this.payload4Order=function(r){var t=JSON.stringify({CUST_ACCOUNT_ID:e.utils.unwrapObservable(r.custAccountId),ACCOUNT_NUMBER:e.utils.unwrapObservable(r.accountNumber),CUSTOMER_NAME:e.utils.unwrapObservable(r.cust_name),OUTLET_NAME:e.utils.unwrapObservable(r.outlet_name),ORDER_NUMBER:e.utils.unwrapObservable(r.order_no),CUST_PO_NUMBER:e.utils.unwrapObservable(r.purchase_order),ORDERED_DATE:e.utils.unwrapObservable(r.order_date),REAL_CUSTOMER:e.utils.unwrapObservable(r.real_customer),ORDER_REMARKS:e.utils.unwrapObservable(r.remarks),SHIP_TO_DISTRICT:e.utils.unwrapObservable(r.ship_to_district),SHIP_TO_ADDRESS:e.utils.unwrapObservable(r.shipping_address),BILL_TO_ADDRESS:e.utils.unwrapObservable(r.billing_address),HEADER_FLOW_STATUS_CODE:e.utils.unwrapObservable(r.status),SOLD_TO_ORG_ID:e.utils.unwrapObservable(r.sold_to_org_id),SHIP_TO_ORG_ID:e.utils.unwrapObservable(r.ship_to_org_id),INVOICE_TO_ORG_ID:e.utils.unwrapObservable(r.invoice_to_org_id),PRICE_LIST_ID:e.utils.unwrapObservable(r.price_list_id),PRICING_DATE:e.utils.unwrapObservable(r.pricing_date),SOLD_FROM_ORG_ID:e.utils.unwrapObservable(r.sold_from_org_id),SHIP_FROM_ORG_ID:e.utils.unwrapObservable(r.ship_from_org_id),SALES_REP_ID:e.utils.unwrapObservable(r.sales_rep_id),TRANSACTIONAL_CURR_CODE:e.utils.unwrapObservable(r.transactional_curr_code),PAYMENT_TERM_ID:e.utils.unwrapObservable(r.payment_term_id),FREIGHT_CHARGE:e.utils.unwrapObservable(r.delivery_cost),OE_HEADER_ID:e.utils.unwrapObservable(r.oe_header_id),ORDER_TYPE_ID:e.utils.unwrapObservable(r.order_type_id),ORDER_TYPE:e.utils.unwrapObservable(r.order_type),ORDER_TOT_AMT:e.utils.unwrapObservable(r.order_tot_amt),WALK_IN_CUST:e.utils.unwrapObservable(r.walk_in_cust),OVERRIDE_SUB_INVENTORY:e.utils.unwrapObservable(r.override_sub_inventory),OVERRIDE_SHIPMENT_METHOD:e.utils.unwrapObservable(r.override_shipment_method),OVERRIDE_SHIPMENT_DATE:e.utils.unwrapObservable(r.override_shipment_date),OVERRIDE_BILL_TO:e.utils.unwrapObservable(r.override_billTo),OVERRIDE_SALES_PERSON:e.utils.unwrapObservable(r.override_salesPerson),PAYMENT_METHOD:e.utils.unwrapObservable(r.payment_method)});return e.utils.parseJson(t)},this.payload4OrderLine=function(r){var t=JSON.stringify({INVENTORY_ITEM_ID:e.utils.unwrapObservable(r.product().id),PRODUCT_DESCRIPTION:e.utils.unwrapObservable(r.product().prod_desc),PRODUCT:e.utils.unwrapObservable(r.product().prod_code),LOT_NUMBER:e.utils.unwrapObservable(r.product().lot)?e.utils.unwrapObservable(r.product().lot):"",ORDER_QUANTITY_UOM:e.utils.unwrapObservable(r.product().sku),UNIT_SELLING_PRICE:e.utils.unwrapObservable(r.product().price),FLOW_STATUS_CODE:e.utils.unwrapObservable(r.product().delivery_status),PRODUCT_BRAND:e.utils.unwrapObservable(r.product().prod_brand),CURRENCY_CODE:e.utils.unwrapObservable(r.product().currency_code),ORDERED_QUANTITY:e.utils.unwrapObservable(r.quantity),SCHEDULE_SHIP_DATE:e.utils.unwrapObservable(r.shipment),ORIGINAL_LINE:e.utils.unwrapObservable(r.original),DRAFT_BEER_FLAG:e.utils.unwrapObservable(r.product().draft_beer_flag),SUBINVENTORY:e.utils.unwrapObservable(r.subInventory),SHIPPING_METHOD:e.utils.unwrapObservable(r.shipmentMethod)?e.utils.unwrapObservable(r.shipmentMethod):null});return e.utils.parseJson(t)},this.cloneCartItem=function(r){var t=JSON.stringify({INVENTORY_ITEM_ID:e.utils.unwrapObservable(r.product().id),PRODUCT_DESCRIPTION:e.utils.unwrapObservable(r.product().prod_desc),PRODUCT:e.utils.unwrapObservable(r.product().prod_code),LOT_NUMBER:e.utils.unwrapObservable(r.product().lot)?e.utils.unwrapObservable(r.product().lot):"",ORDER_QUANTITY_UOM:e.utils.unwrapObservable(r.product().sku),UNIT_SELLING_PRICE:e.utils.unwrapObservable(r.product().price),FLOW_STATUS_CODE:e.utils.unwrapObservable(r.product().delivery_status),PRODUCT_BRAND:e.utils.unwrapObservable(r.product().prod_brand),CURRENCY_CODE:e.utils.unwrapObservable(r.product().currency_code),ORDERED_QUANTITY:e.utils.unwrapObservable(r.quantity),SCHEDULE_SHIP_DATE:e.utils.unwrapObservable(r.shipment),ORIGINAL_LINE:e.utils.unwrapObservable(r.original),DRAFT_BEER_FLAG:e.utils.unwrapObservable(r.product().draft_beer_flag),SUBINVENTORY:e.utils.unwrapObservable(r.subInventory),SHIPPING_METHOD:e.utils.unwrapObservable(r.shipmentMethod),REMARK:e.utils.unwrapObservable(r.product().remark)}),s=e.utils.unwrapObservable(r.quantity),a=e.utils.unwrapObservable(r.shipment),_=e.utils.unwrapObservable(r.original),i=e.utils.unwrapObservable(r.lotArray),o=e.utils.unwrapObservable(r.shipmentMethod),b=e.utils.unwrapObservable(r.subInventory),l=new n(e.utils.parseJson(t));return l.specialDiscount=r.product().specialDiscount,l.specialAmount=r.product().specialAmount,l.promotionItem=r.product().promotionItem,l.isFetchModifier=r.product().isFetchModifier,new u(l,s,!1,a,_,i,b,o)},this.restoreCart=function(r){var t=e.observableArray(),s=e.utils.unwrapObservable(r).length;for(index=0;index<s;index++){var a=this.cloneCartItem(r()[index]);t.push(a)}return t},this.cloneCart=function(e){return this.restoreCart(e)},this.setCart=function(e){_.cart=e},this.getCart=function(){return _.cart},this.findProduct=function(t,s,a){var _;if(r(s()).each(function(r,s){e.toJSON(s.id)===e.toJSON(t)&&(_=s)}),"undefined"==typeof _){var i;if(r(a()).each(function(r,s){e.toJSON(s.id)===e.toJSON(t)&&(i=s)}),"undefined"!=typeof i)return i}},this.addToCart=function(e){var r;return r=e,r.showAddCartBtn(!1),r.quantity(1),r},this.createShipment=function(e,r,t){return new l(e,r,t)},this.allowCheckOut=function(r){var t=e.utils.unwrapObservable(r);return"undefined"!=typeof t&&t.length>0},_.getOfflineKey=function(){var e=t.moduleConfig.params.rootContext.userProfile,r=a.SAVED_ORDER_KEY+":"+e.orgUnitId+":"+e.erpSalesId+":"+e.salesRole+":"+e.username;return r}}return new _});