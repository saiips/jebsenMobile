define(["knockout","jquery","appController","pages/common/constant","util/appui"],function(F,E,e,r,C){"use strict";function O(){function E(){var F=e.moduleConfig.params.rootContext.platform;return"iOS"===F}function O(F,e){if(E()){try{e="_"+unescape(encodeURIComponent(F)).split("").map(function(F){return F.charCodeAt(0).toString(16)}).join("_")}catch(E){e=F,console.log("invalid text input: "+F)}return e}return F}var n=this,a=830,D=870,T=70,I=130,S="現金",l="支票",_="其他",N="Cash",R="Cheque",t="Others",B="^XA^LRN^CI0^XZ \n^XA^CWZ,E:PMINGLIU.TTF^FS^XZ \n^XA \n^XZ \n",P="^XA \n",A="^FO255,"+I+"^GFA,1898,1898,13,,:N01FJ01E,M027FJ01F98,L01E66J01DCE,L01EDC08020E4E,L013BFF807FF3B,L09467FE1FFCC56,K038CC03E1F006678,K078807FC07FC0238,K061E001802401E08,K0D3E7FJ01FCF2C,K0DEC0FJ03E0CF6,K09DEE3CI078EE76,K08B87FCI07F8322,L06036J01F008,00180C0CO0C0602,00183CFFN01FC787,003C79E7N03CE787,007E680EN01E06DF8,003FD9FCO0FF25F8,0014BT034F,0034BT01A5,003544R014A58,00344FJ018L03ED58,0030FFJ0FFEK01FE5,0334E6I01802L0CE53,03B49E00F8M0C0E6D3,03F43003B8L0380385F8,07F0800798K03FI025F8,06903807FB6J03F0038168,06C3F801FBFFE48FF803F058,06C73003F7KFC3C039C5C,06CCFI07KFE00C01CE5C,034B8J0IFE0E0040072D8,0366K01CP08D,3B4FCK0EO07CD3,191FEU0FF27,1CB1CU0F32F,3E2FV03C8F8,3418N0BF8L060D8,16018L01FFEK0380D,16C78P03J03CDD,36CF8006M03EI03ECD8,34CF8007CL0678007EED8,15EB8003FK0377C0036E7,176AI03F8012FF3FI01ABF,1766I079LFBFJ0CBB,036CI0E01KFBEJ04B,1168I0801LFK06B2,1D58L08I0EL0227,1D13P0CK0192F,3C0FV03C0F,3B0F8U03C178,1D9DV03636,0D99L03AN0372E,06DBL0FFEM0366C,034BV01AD,035AJ0FN0C001AB8,0196E00798L07800CA7,0040E00798K03FI0C04,0121E003FBEDI07F001F01,0F31F003F3JFDFF801F3BC,0F796003F7KF81C00F7BC,052F6I07KFE00C01BCA8,068F7J03FE00EJ019D4C,07176K0EN01BF18,011F6K06O0BA2,00436U098C,03F040CQ04083F,01FC80CQ0E007F,01F701FP03F039E,00FD81BP03F02FE,003F80F6N01B603F,001E00DB8M03B401F,001F1F1F98K077A1F1E,I0DDFCE9FJ01F7C7E6E,001ECFE2CFJ01E59EE4E,I0700725B8I0765BC01C,I02273B7D8I077D33D98,J0FEEC2ECI06C86EFE,J0F3F0A6EI0D921F9E,J0F800D34I0D86003C,J01FA062J018C0FE,K01202N011,M08207803C002,N0DC1E0E07C,M01E6079818E,M039E00E00F3,M07FC00700FF8,M07E0071C01FC,N0801C0F002,P078038,P06I0C,,::00F,:::00FP018,00F01FF01FC00FE03FC06007,00F00E101CE0182038406006,00F00E001C70180038007006,00F00E001C70180038007806,00F00E001C601C0038007C06,00F00E001C601E0038004E06,00F00E001CC00F0038004706,00F00FF01FE007803FC04386,00F00E001C7003C0384041C6,00F00E001C3801E0380040E2,00F00E001C3800E038004072,00F00E001C1800603800403E,00F00E001C1800603800401E,00F00E001C3820603800600E,00F00E181C7030C03C606006,00E01FF03FC01F807FC0E002,00E,:01C,018,03,0E,,:::::::N0F83F1FCFC,N08C30180CE,N08420180C6,:N0DC30180CC,N0FC3F1F8FC,N08630180CC,N08220180C6,:N08E30180C3,N0FC3F1FCC18,,::^FS \n",u="^CF0,23 \n",c="^CWK,E:PMINGLIU.TTF^FS \n",p="^CI28^AZN,0,23",o="^FO35",i=o+",290"+p+"^FB510,1,,c^FH^FDJebsen Beverage Company Limited^FS \n"+o+",320"+p+"^FB510,1,,c^FH^FD28F, Lee Garden Two,^FS \n"+o+",350"+p+"^FB510,1,,c^FH^FD28 Yun Ping Road, Causeway Bay, HK^FS \n"+o+",380"+p+"^FB510,1,,c^FH^FD2923-8432^FS \n",M=o+",410"+p+"^FB510,4,,c^FH^FDCASH SALES MEMO^FS \n",s=o+",460"+p+"^FB510,1,,l^FH^FDDate: {DATE}^FS \n"+o+",490"+p+"^FB510,1,,l^FH^FD"+O("日期",16)+"^FS \n"+o+",520"+p+"^FB510,1,,l^FH^FDOrder #: {ORDER_NUMBER}^FS \n"+o+",550"+p+"^FB510,1,,l^FH^FD"+O("單號",16)+"^FS \n"+o+",580"+p+"^FB510,1,,l^FH^FDAccount #: {ACCOUNT_NUMBER}^FS \n"+o+",610"+p+"^FB510,1,,l^FH^FD"+O("客戶號",16)+"^FS \n"+o+",460"+p+"^FB510,1,,r^FH^FDTime: {TIME}^FS \n"+o+",490"+p+"^FB510,1,,r^FH^FD"+O("時間",16)+"^FS \n"+o+",520"+p+"^FB510,1,,r^FH^FDDN: {DELIVERY_NUMBER}^FS \n"+o+",550"+p+"^FB510,1,,r^FH^FD"+O("送貨單",16)+"^FS \n"+o+",580"+p+"^FB510,1,,r^FH^FDVan: {CAR_PLATE_NUMBER}^FS \n"+o+",610"+p+"^FB510,1,,r^FH^FD"+O("車號",16)+"^FS \n"+o+",640"+p+"^FB510,2,,l^FH^FDCustomer "+O("客戶",16)+": {OUTLET_NAME}^FS \n"+o+",710^GB525,1,3^FS \n"+o+",730"+p+"^FB200,1,,l^FH^FDProduct^FS \n"+o+",760"+p+"^FB200,1,,l^FH^FD"+O("產品",16)+"^FS \n^FO230,730"+p+"^FB70,1,,r^FH^FDPrice^FS \n^FO230,760"+p+"^FB70,1,,r^FH^FD"+O("價錢",16)+"^FS \n^FO320,730"+p+"^FB50,1,,r^FH^FDQty^FS \n^FO320,760"+p+"^FB60,1,,r^FH^FD"+O("數量",16)+"^FS \n^FO370,730"+p+"^FB190,1,,r^FH^FDTotal^FS \n^FO370,760"+p+"^FB190,1,,r^FH^FD"+O("總數",16)+"^FS \n"+o+",800^GB525,1,3^FS \n",H=o+",{POSITION_PRODUCT}"+p+"^FB510,2,,l^FD{LINE_NUMBER}. {PRODUCT} - ^FH^FD{PRODUCT_DESCRIPTION}^FS \n^FO230,{POSITION_PRICE1}"+p+"^FB70,1,,r^FD{UNIT_SELLING_PRICE}^FS \n^FO320,{POSITION_PRICE2}"+p+"^FB40,1,,r^FD{ORDERED_QUANTITY}^FS \n^FO370,{POSITION_PRICE3}"+p+"^FB190,1,,r^FD{TOTAL}^FS \n",L=o+",{POSITION_TOTAL}"+p+"^FB510,1,,r^FH^FDTotal "+O("總數",16)+": {ORDER_TOT_AMT}^FS \n",b=o+",{POSITION_METHOD}"+p+"^FB510,1,,r^FH^FD{PAYMENT_METHOD} {PAYMENT_METHOD_CHI}: {ORDER_TOT_AMT}^FS \n",v=o+",{POSITION_SHIP2ADDR_ENG}"+p+"^FH^FDShip To:^FS \n"+o+",{POSITION_SHIP2ADDR_CHI}"+p+"^FH^FD"+O("送貨地址",16)+"^FS \n"+o+",{POSITION_SHIP2ADDR}"+p+"^FB510,4,,l^FH^FD{SHIP_TO_ADDRESS}^FS \n",U=o+",{POSITION_REMARKS1}"+p+"^FH^FDRemarks:^FS \n"+o+",{POSITION_REMARKS2}"+p+"^FH^FD"+O("備註",16)+"^FS \n"+o+",{POSITION_REMARKS3}"+p+"^FB510,5,,1^FH^FD{REMARKS}^FS \n",K=o+",{POSITION_FOOTER1}"+p+"^FB510,1,,c^FH^FDThank you for your Purchase^FS \n"+o+",{POSITION_FOOTER2}"+p+"^FB510,1,,c^FH^FD"+O("多謝惠顧",16)+"^FS \n"+o+",{POSITION_FOOTER3}"+p+"^FB510,2,,c^FH^FDThe ink will eventually fade out. Please make photocopy for a more lasting document.^FS \n"+o+",{POSITION_FOOTER4}"+p+"^FB510,1,,c^FH^FD"+O("單據字體會褪色，若需保留請自行影印。",16)+"^FS \n",w="^XZ \n";n.isPrinterPaired=function(){if(E()){var F=e.moduleConfig.params.rootContext.serialNo;if(F)return F;var F=C.getLocalStorage(r.PRINTER_SERIAL_NO);return F}var F=e.moduleConfig.params.rootContext.macAddress;if(F)return F;var F=C.getLocalStorage(r.PRINTER_MAC_ADDRESS);return F},n.getTemplate=function(E,e){console.log("data = "+F.toJSON(E));var C=new String(s);C=C.replace("{DATE}",F.utils.unwrapObservable(E.DATE)),C=C.replace("{ORDER_NUMBER}",F.utils.unwrapObservable(E.ORDER_NUMBER)),C=C.replace("{ACCOUNT_NUMBER}",F.utils.unwrapObservable(E.ACCOUNT_NUMBER)),C=C.replace("{TIME}",F.utils.unwrapObservable(E.TIME)),C=C.replace("{DELIVERY_NUMBER}",F.utils.unwrapObservable(E.DELIVERY_NUMBER));var n=F.utils.unwrapObservable(E.CAR_PLATE_NUMBER);n||(n="N/A");var I=n.indexOf("-");I>0&&(n=n.substring(I+1)),C=C.replace("{CAR_PLATE_NUMBER}",n),C=C.replace("{OUTLET_NAME}",O(F.utils.unwrapObservable(E.OUTLET_NAME),16));var p=1,o="",d=a,J=D;F.utils.arrayForEach(e,function(E){var e=new String(H),r=F.utils.unwrapObservable(E.product().prod_code),C=F.utils.unwrapObservable(E.product().prod_desc),n=F.utils.unwrapObservable(E.product().price),a=F.utils.unwrapObservable(E.quantity),D=F.utils.unwrapObservable(E.cost);e=e.replace("{POSITION_PRODUCT}",d),e=e.replace("{POSITION_PRICE1}",J),e=e.replace("{POSITION_PRICE2}",J),e=e.replace("{POSITION_PRICE3}",J),e=e.replace("{LINE_NUMBER}",p),e=e.replace("{PRODUCT}",r),e=e.replace("{PRODUCT_DESCRIPTION}",O(C,16)),e=e.replace("{UNIT_SELLING_PRICE}",n),e=e.replace("{ORDERED_QUANTITY}",a),e=e.replace("{TOTAL}",D),p++,e&&(o+=e,d+=T,J+=T)});var Y=J+50,g=new String(L);g=g.replace("{POSITION_TOTAL}",Y),g=g.replace("{ORDER_TOT_AMT}",F.utils.unwrapObservable(E.ORDER_TOT_AMT));var f=S,m=N;F.utils.unwrapObservable(E.PAYMENT_METHOD)==r.PAY_BY_CASH?(f=S,m=N):F.utils.unwrapObservable(E.PAYMENT_METHOD)==r.PAY_BY_CHEQUE?(f=l,m=R):F.utils.unwrapObservable(E.PAYMENT_METHOD)==r.PAY_BY_OTHERS&&(f=_,m=t),Y+=30;var h=new String(b);h=h.replace("{POSITION_METHOD}",Y),h=h.replace("{PAYMENT_METHOD}",m),h=h.replace("{PAYMENT_METHOD_CHI}",O(f,16)),h=h.replace("{ORDER_TOT_AMT}",F.utils.unwrapObservable(E.ORDER_TOT_AMT)),E.PAYMENT_METHOD&&null!=E.PAYMENT_METHOD&&F.utils.unwrapObservable(E.PAYMENT_METHOD)!=r.PAY_BY_OTHERS||(h=""),Y+=70;var y=new String(v);y=y.replace("{POSITION_SHIP2ADDR_ENG}",Y),Y+=30,y=y.replace("{POSITION_SHIP2ADDR_CHI}",Y),Y+=30,y=y.replace("{POSITION_SHIP2ADDR}",Y),y=y.replace("{SHIP_TO_ADDRESS}",O(F.utils.unwrapObservable(E.SHIP_TO_ADDRESS),16));var G=new String(U),V=Y+110;G=G.replace("{POSITION_REMARKS1}",V),V+=30,G=G.replace("{POSITION_REMARKS2}",V),V+=30,G=G.replace("{POSITION_REMARKS3}",V),G=G.replace("{REMARKS}",O(F.utils.unwrapObservable(E.REMARKS),16));var X=new String(K),k=V+110;X=X.replace("{POSITION_FOOTER1}",k),k+=30,X=X.replace("{POSITION_FOOTER2}",k),k+=40,X=X.replace("{POSITION_FOOTER3}",k),k+=60,X=X.replace("{POSITION_FOOTER4}",k);var Q=B+P+A+u+c+i+M+C+o+g+h+y+G+X+w;return Q}}return new O});