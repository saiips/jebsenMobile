define(["knockout","jquery","util/appui","util/devmode","appController","util/commonhelper","pages/common/constant","pages/dataSync/orderHistService","pages/dataSync/newOrderService","pages/dataSync/quotationService"],function(e,t,o,r,s,n,I,_,a,i){function u(){function u(e){var t=s.moduleConfig.params.rootContext.userProfile.orgUnitId;e&&(t=e);var o=s.moduleConfig.params.rootContext.userProfile.erpSalesId,r=s.moduleConfig.params.rootContext.userProfile,n=JSON.stringify({InputGetCustomers:{HeaderInfo:{UserID:r.username,UserRole:r.salesRole,CallerID:""},P_ORG_ID:t,P_SALESREP_ID:o}});return n}function l(l){var C=t.Deferred(),S=u(l),R=e.utils.parseJson(S),T=R.InputGetCustomers.HeaderInfo.UserID,d=R.InputGetCustomers.HeaderInfo.UserRole,D=R.InputGetCustomers.P_ORG_ID,c=R.InputGetCustomers.P_SALESREP_ID,E=I.CUSTOMER_LIST_KEY+":"+D+":"+c;return r.isEnabled()&&r.isOffline()?t.getJSON("js/app/pages/customer/customerListMock.json",function(e){setTimeout(function(){C.resolve(e,{status:200})},500)}):(console.log("[Amplify Request] Customer List - "+E),console.log("payload ="+e.toJS(S)),amplify.request({resourceId:I.CUSTOMER_LIST_KEY,success:C.resolve,error:C.reject,data:S}),o.setLocalStorage(E+":"+I.CUSTOMERS_SYNC_DATETIME,n.getClientCurrentDate(I.DATETIME_FORMAT).toUpperCase()),t.when(C).done(function(t,r,n){o.setLocalStorage(E,t);var u=s.moduleConfig.params.rootContext.userProfile,l=t.P_CUSTOMER_TBL_ITEM;console.log("customer list = "+l.length);var C=[],S=[],R=[];s.moduleConfig.params.rootContext.lastPayload4QuotationDetailList=[],o.updateDownloadRequestCount(I.P_CUST_CNT,l.length),u.salesRole!=I.SR_ADMIN&&e.utils.arrayForEach(l,function(e){if(u.salesRole==I.SR_MOBILE_SALE){var t=JSON.stringify({InputParameters:{HeaderInfo:{UserID:T,UserRole:d,CallerID:""},P_ORG_ID:D,P_ACCOUNT_NUMBER:e.CUST_ACCOUNT_ID,P_SHIP_TO_ORG_ID:e.SHIP_TO_SITE_ID}}),r=D+":"+e.CUST_ACCOUNT_ID+":"+e.SHIP_TO_SITE_ID;C.indexOf(r)<0?(C.push(r),_.registerService(t)):o.updateDownloadRequestCount(I.P_ORDER_CNT,1)}if(u.salesRole!=I.SR_ADMIN&&e.PRICE_LIST_ID!=I.PRICE_ID_BEER&&e.PRICE_LIST_ID!=I.PRICE_ID_WINE){var s=[],n=[];s.push(e.PRICE_LIST_ID),n.push({PRICE_LIST_ID:s[0]}),t=JSON.stringify({InputGetPriceList:{HeaderInfo:{UserID:T,UserRole:d,CallerID:""},P_ORG_ID:D,P_PRICE_LIST_ID_TBL:{P_PRICE_LIST_ID_TBL_ITEM:n}}});var r=D+":"+e.PRICE_LIST_ID;S.indexOf(r)<0?(S.push(r),a.registerService(t)):o.updateDownloadRequestCount(I.P_PRICE_CNT,1)}else o.updateDownloadRequestCount(I.P_PRICE_CNT,1);if("MS"==u.salesRole&&u.orgUnitId==I.ORG_UNIT_ID_WINE){var l=JSON.stringify({InputGetQuotation:{HeaderInfo:{UserID:u.username,UserRole:u.salesRole,CallerID:""},P_ORG_ID:u.orgUnitId,P_ACCOUNT_NUMBER:e.ACCOUNT_NUMBER,P_SHIP_TO_ORG_ID:e.BILL_TO_SITE_ID}}),r=u.orgUnitId+":"+e.ACCOUNT_NUMBER+":"+e.BILL_TO_SITE_ID;R.indexOf(r)<0?(R.push(r),i.registerService(l)):o.updateDownloadRequestCount(I.P_QUOTE_CNT,1)}})}).fail(function(){console.log("Failed to download the customer list")})),E}this.registerService=function(){return l()},this.registerWineService=function(e){return l(e)},this.registerBeerService=function(e){return l(e)}}return new u});