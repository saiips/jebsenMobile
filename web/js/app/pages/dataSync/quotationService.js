define(["knockout","jquery","module","amplify","appController","pages/common/constant","util/devmode","util/appui","util/commonhelper","pages/dataSync/quotationDetailService"],function(e,t,o,n,i,a,r,u,s,l){function _(){function o(o){var _=t.Deferred(),c=e.utils.parseJson(o),I=c.InputGetQuotation.P_ORG_ID,T=c.InputGetQuotation.P_SHIP_TO_ORG_ID,f=a.QUOTATION_LIST_KEY+":"+I+":"+T;return r.isEnabled()&&r.isOffline()?(t.getJSON("js/app/pages/quotation/quotationMock.json",function(e){setTimeout(function(){_.resolve(e,{status:200})},500)}),f):(console.log("[Amplify Request] Quotation List - "+f),n.request({resourceId:a.QUOTATION_LIST_KEY,success:_.resolve,error:_.reject,data:o}),u.setLocalStorage(f+":"+a.QUOTATION_LIST_SYNC_DATETIME,s.getClientCurrentDate(a.DATETIME_FORMAT).toUpperCase()),t.when(_).done(function(t,o,n){u.setLocalStorage(f,t);var r=t.P_QUOTATION_TBL.P_QUOTATION_TBL_ITEM;u.updateDownloadRequestCount(a.P_QUOTE_CNT,1),e.utils.arrayForEach(r,function(e){var t=i.moduleConfig.params.rootContext.userProfile,o=JSON.stringify({InputGetQuotationLines:{HeaderInfo:{UserID:t.username,UserRole:t.salesRole,CallerID:""},P_ORG_ID:t.orgUnitId,P_HEADER_ID:e.OE_HEADER_ID}}),n=t.orgUnitId+":"+e.OE_HEADER_ID;i.moduleConfig.params.rootContext.lastPayload4QuotationDetailList.indexOf(n)<0&&(i.moduleConfig.params.rootContext.lastPayload4QuotationDetailList.push(n),l.registerService(o))})}).fail(function(){u.updateDownloadRequestCount(a.P_QUOTE_CNT,1)}),f)}function _(o){var i=t.Deferred(),s=e.utils.parseJson(o),l=s.InputGetQuotationLines.P_ORG_ID,_=s.InputGetQuotationLines.P_HEADER_ID,c=a.QUOTATION_DETAIL_KEY+":"+l+":"+_;return r.isEnabled()&&r.isOffline()?(t.getJSON("js/app/pages/quotation/quotationLineMock.json",function(e){setTimeout(function(){i.resolve(e,{status:200})},500)}),c):(console.log("[Amplify Request] Quotation Line - "+c),n.request({resourceId:a.QUOTATION_DETAIL_KEY,success:i.resolve,error:i.reject,data:o}),t.when(i).done(function(e,t,o){u.setLocalStorage(c,e)}),c)}this.registerService=function(e){return o(e)},this.getQuotationItem=function(e){return _(e)}}return new _});