define(["knockout","jquery","amplify","util/appui","util/devmode","appController","pages/common/constant","util/commonhelper","pages/dataSync/deliveryDetailService"],function(e,t,r,n,o,a,i,s,l){function u(){function u(){var e=a.moduleConfig.params.rootContext.userProfile,t=JSON.stringify({InputGetShipmentListByCarPlate:{HeaderInfo:{UserID:e.username,UserRole:e.salesRole,CallerID:""},P_ORG_ID:e.orgUnitId,P_CP_NUMBER:e.licenseNo}});return t}function I(){var I=t.Deferred(),_=u(),p=e.utils.parseJson(_),c=p.InputGetShipmentListByCarPlate.HeaderInfo.UserID,f=p.InputGetShipmentListByCarPlate.HeaderInfo.UserRole,E=p.InputGetShipmentListByCarPlate.HeaderInfo.CallerID,C=p.InputGetShipmentListByCarPlate.P_ORG_ID,D=p.InputGetShipmentListByCarPlate.P_CP_NUMBER,d=i.DELIVERY_LIST_BY_CAR_PLATE_KEY+":"+c+":"+f+":"+E+":"+C+":"+D;o.isEnabled()&&o.isOffline()?t.getJSON("js/app/pages/delivery/deliveryMock.json",function(e){setTimeout(function(){I.resolve(e,{status:200})},500)}):(console.log("[Amplify Request] Delivery List by License No - "+d),r.request({resourceId:i.DELIVERY_LIST_BY_CAR_PLATE_KEY,success:I.resolve,error:I.reject,data:_}),n.setLocalStorage(d+":"+i.DELIVERY_LIST_SYNC_DATETIME,s.getClientCurrentDate(i.DATETIME_FORMAT).toUpperCase()),t.when(I).done(function(t,r,o){n.setLocalStorage(d,t);var s=t.P_SHIPMENT_TBL_ITEM;n.updateDownloadRequestCount(i.P_DELIVERY_CNT,1);var u=a.moduleConfig.params.rootContext.userProfile;e.utils.arrayForEach(s,function(e){var t=JSON.stringify({InputGetShipmentDetails:{HeaderInfo:{UserID:u.username,UserRole:u.salesRole,CallerID:""},P_ORG_ID:u.orgUnitId,P_DELIVERY_NUM:e.DELIVERY_NUMBER}});l.registerService(t)})}).fail(function(){n.updateDownloadRequestCount(i.P_DELIVERY_CNT,1)}))}this.registerService=function(){return I()},this.getData=function(e){return n.getLocalStorage(e)}}return new u});