define(["ojs/ojcore","knockout","jquery","appController","pages/common/cartService","util/appui","util/commonhelper","ojs/ojknockout","ojs/ojdatetimepicker","ojs/ojtimezonedata","ojs/ojrouter","ojs/ojtoolbar","ojs/ojinputtext","ojs/ojbutton","ojs/ojinputnumber","ojs/ojmodel","ojs/ojpulltorefresh","ojs/ojvalidation","ojs/ojoffcanvas"],function(e,t,o,n,r,a,l){function i(){function i(){console.log("init called"),d.cartItem.removeAll(),d.cart.removeAll(),d.cartItem.push(n.moduleConfig.params.rootContext.selectedItem),console.log("self.cartItem ="+t.toJSON(d.cartItem)),d.cart=r.getCart(),console.log("self.cart ="+t.toJSON(d.cart)),d.totalQty(t.utils.unwrapObservable(d.cartItem()[0].quantity)),console.log("totalQty = "+t.toJSON(d.totalQty)),d.minShipmentDate(s()),c(t.utils.unwrapObservable(d.cartItem()[0].shipment))}function s(){return l.getClientCurrentDate("YYYY-MM-DD")}function u(){var e=0;return o(d.allShipment()).each(function(t,o){e+=o.quantity()}),e}function c(e){console.log("defaultShipment invoked"),console.log("date = "+e);var o=l.getClientNextDate("YYYY-MM-DD");l.isValid(e)&&(o=l.formatStrDate(e,"YYYY/MM/DD","YYYY-MM-DD"));var n=t.utils.unwrapObservable(d.totalQty),a=u(),i=n-a,s=1;s=0===d.allShipment().length?1:d.allShipment().length+1;var c=r.createShipment(s,o,i);d.allShipment.push(c),console.log("All shipment = "+t.toJSON(d.allShipment))}function m(){var e=!1;return t.utils.arrayMap(d.allShipment(),function(t){0==t.quantity&&(e=!0)}),e}function p(){var t=e.Translations.getTranslatedString;d.lng_shipment=t("ssa.shipment.shipment"),d.lng_itemsDetail=t("ssa.shipment.itemsDetail"),d.lng_shipmentDate=t("ssa.shipment.shipmentDate"),d.lng_quantity=t("ssa.shipment.quantity"),d.lng_done=t("ssa.shipment.done")}var d=this;p(),d.router=n.router,console.log("ShipmentViewModel"),d.currCustId=t.observable(),d.currSelectedItem=t.observable(),d.cartItem=t.observableArray(),d.cart=t.observableArray(),d.allShipment=t.observableArray(),d.totalQty=t.observable(0),d.minShipmentDate=t.observable(),d.dataFormat=t.observable("yyyy-MM-dd"),d.dateConverter=t.observable(e.Validation.converterFactory(e.ConverterFactory.CONVERTER_TYPE_DATETIME).createConverter({pattern:d.dataFormat()})),d.allowAdd=t.computed(function(){var e=t.utils.unwrapObservable(d.totalQty),o=u();return!(o>=e)}),d.allowRemove=t.computed(function(){return d.allShipment().length>=2}),d.handleActivated=function(t){var o=t.valueAccessor().params.ojRouter.parentRouter;console.log("shipment.js parentRouter="+o.currentState().value),d.currSelectedItem(n.moduleConfig.params.rootContext.selectedItem);var r=o.getChildRouter("shipment");return r||(r=o.createChildRouter("shipment")),d.router=r.configure(function(t){if(t){var o=new e.RouterState(t,{value:t,enter:function(){d.currCustId(t),console.log("stateId="+t)}});return o}}),e.Router.sync()},d.currSelectedItem.subscribe(function(e){console.log("newSelectedItem="+t.toJSON(e)),i()}),d.shipments=t.computed(function(){return d.allShipment}),d.addShipment=function(e,t){c()},d.removeShipment=function(e,o){console.log("data = "+t.toJSON(e)),console.log("removeShipment clicked"),d.allShipment.remove(e),console.log("self.allShipment = "+t.toJSON(d.allShipment))},d.done=function(e,o){console.log("done button clicked");var l=u();if(l!=t.utils.unwrapObservable(d.totalQty))a.showMessageBox("Please double check the quantity you inputted for changing the original shipment.");else if(m())a.showMessageBox("Please double check the quantity you inputted for changing the original shipment.");else{for(var i=n.moduleConfig.params.rootContext.custId,s=d.cart.indexOf(n.moduleConfig.params.rootContext.selectedItem),c=d.allShipment().length,p=0;p<c;p++){var h=t.utils.unwrapObservable(d.allShipment()[p].shipmentDate),g=t.utils.unwrapObservable(d.allShipment()[p].quantity);if(0==p)d.cartItem()[0].shipment=h,d.cartItem()[0].quantity=g,d.cart.splice(s,1,d.cartItem()[0]);else if(p>0){var v=r.cloneCartItem(d.cartItem()[0]);console.log("newCartItem = "+t.toJSON(v)),v.shipment=h,v.quantity=g,d.cart.splice(s+1,0,v)}}n.moduleConfig.params.rootContext.originalCart=d.cart,n.moduleConfig.params.rootContext.fromShipment="Y",n.redirect("checkOut",i)}},d.dispose=function(e){d.router.dispose()},d.goBack=function(e,t){console.log("goBack clicked"),n.moduleConfig.params.rootContext.originalCart=d.cart,n.moduleConfig.params.rootContext.fromShipment="Y";var o=n.moduleConfig.params.rootContext.custId;n.redirect("checkOut",o)}}return t.bindingHandlers.winsize={init:function(e,t,n,r,a){o(window).resize(function(){r.screenWidth(o(window).width()),r.screenHeight(o(window).height())})}},t.bindingHandlers.currency={symbol:t.observable("$"),update:function(e,o,n){return t.bindingHandlers.text.update(e,function(){var e=+(t.utils.unwrapObservable(o())||0),r=t.utils.unwrapObservable(void 0===n().symbol?n().sybmol:"$");return r+e.toFixed(2).replace(/(\d)(?=(\d{3})+\.)/g,"$1,")})}},t.bindingHandlers.readOnly={update:function(e,o){var n=t.utils.unwrapObservable(o());n?e.setAttribute("readOnly",!0):e.removeAttribute("readOnly")}},i});